;(function(global,undefined){var Venus=global.Venus;var util=Venus.util,mix=util.mix,PI=Math.PI,isArray=util.isArray,isObject=util.isObject,getColor=util.getColors,charts={},DEFAULT_Y_AXIS="y",DEFAULT_X_AXIS="x",UNDER_TICK='under-tick',CONTINUOUS="continuous",DISCRETE='discrete',DATETIME="datetime";function Chart(container,data,options){container=typeof container==="string"?document.getElementById(container):container;if(!container||!container.nodeType){return;}
this.container=container;this.data=data||[];this.events=new Venus.util.CustomEvent();var defaultOptions={width:container.clientWidth,height:container.clientHeight,colors:[],axis:{},axisUsage:{},grid:{opacity:0.4},tooltip:function(obj){return obj.y;},icons:{},threshold:{}},self=this;this.options=mix(defaultOptions,util.clone(options)||{});this.stage=new Raphael(container,this.options.width,this.options.height);this.stardBox=this.stage.rect(0,0,this.options.width,this.options.height).attr('stroke-width',0)
this.coordinate=this._initCoordinate();this.iconFactory=this._initIconFactory();this._initEvents();this._initData();this.events.fire('onDataInit',this.series);this.colors=this.options.colors&&this.options.colors.length?this.options.colors:getColor(this.series.getSeries().length);this._initAxis();this.events.fire('onAxisInit',{});this._initLabels();this._initLegend();this.events.fire('onLegendInit',this.legend);this._draw();this._initGrid();this.events.fire('onGridInit',this.grid);this._initThreshold();this._renderAxis();this.events.fire('onFinish');}
Chart.prototype={constructor:Chart,_initData:function(){this.series=new Series(this.data);},_initLabels:function(){var data=this.series.getSeries(),labels=this.series.getLabels(),_labels=[],self=this,coordinate=self.coordinate;data.forEach(function(d,j){if(d.name!==undefined){_labels.push(d.name);}else if(Venus.util.isNumber(d.data)){_labels.push(labels[j]||(coordinate.x&&coordinate.x.options.ticks?coordinate.x.options.ticks[j]||'':""));}else{_labels.push('');}});this.labels=_labels;},_initCoordinate:function(){var self=this,options=self.options;return{axises:{},push:function(name,axis){this.axises[name]=axis},use:function(x,y){if(isObject(x)){this.x=this.axises[x.x];this.y=this.axises[x.y];this.xName=x.x;this.yName=x.y;return;}
this.x=this.axises[x];this.y=this.axises[y];this.xName=x;this.yName=y;},get:function(key,value){var xOpt=this.x.options,yOpt=this.y.options,xModel=this.x.model,yModel=this.y.model,xObj,yObj,x,y,xTick,yTick;xObj=this.x.getPoint(key);x=xObj.length;xTick=xObj.tick;yObj=this.y.getPoint(value);y=yObj.length;yTick=yObj.tick;if(yModel.reverse){y=yModel.totalWidth-y;}
if(xModel.reverse){x=xModel.totalWidth-x;}
if(xModel.rotate==90&&yModel.rotate==0){return{y:xModel.beginY-x,x:yModel.beginX+y,xTick:xTick,yTick:yTick}}else{return{x:xModel.beginX+x,y:yModel.beginY-y,xTick:xTick,yTick:yTick}}},size:function(){var width,height;if(this.x.model.rotate==90){height=this.x.model.totalWidth;}else{width=this.x.model.totalWidth;}
if(this.y.model.rotate==90){height=this.y.model.totalWidth;}else{width=this.y.model.totalWidth;}
return{width:width,height:height}},distance:function(axis,point){if(axis.model.rotate==0){return point.y-axis.model.beginY;}else{return point.x-axis.model.beginX;}},getAxisUse:function(i){if(!this.axisUsageArray){var arr=this.axisUsageArray=[];self.series.getSeries().forEach(function(s,_index){if(!options.axisUsage||!options.axisUsage[_index]){arr.push({x:DEFAULT_X_AXIS,y:DEFAULT_Y_AXIS});}else{arr.push({x:options.axisUsage[_index][0]||DEFAULT_X_AXIS,y:options.axisUsage[_index][1]||DEFAULT_Y_AXIS});}});}
return this.axisUsageArray[i];},getRelatedSeries:function(axisName){var result=[],axisUsage=self.options.axisUsage;if(axisName==DEFAULT_X_AXIS){self.series.getSeries().forEach(function(s,i){if(!axisUsage||!axisUsage[i]||!axisUsage[i][0]){result.push(i);}});}else if(axisName==DEFAULT_Y_AXIS){self.series.getSeries().forEach(function(s,i){if(!axisUsage||!axisUsage[i]||!axisUsage[i][1]){result.push(i);}});}else{self.series.getSeries().forEach(function(s,i){if(axisUsage&&axisUsage[i]&&(axisUsage[i][0]===axisName||axisUsage[i][1]===axisName)){result.push(i);}});}
return result;},useDefault:function(){this.use(DEFAULT_X_AXIS,DEFAULT_Y_AXIS);},type:function(axis){typeof axis==="string"||(axis=axis.axisName);return axis.indexOf('x')==0?'x':'y';},isX:function(axis){return this.type(axis)=='x';},isY:function(axis){return this.type(axis)=='y';}};},_initIconFactory:function(){var self=this,nativeIcons={'rect':{create:function(stage,x,y,width){return{icon:stage.rect(x-width/2,y-width/2,width,width),position:this.position,animate:this.animate,size:this.size}},size:function(w){this.icon.attr('width',w);},position:function(x,y){if(arguments.length==0){return{x:this.icon.attr('x')+this.icon.attr('width')/2,y:this.icon.attr('y')+this.icon.attr('width')/2}}
this.icon.attr({'x':x,'y':y});},animate:function(obj,duration){if(obj.x){obj.x=obj.x-this.icon.attr('width')/2;}
if(obj.y){obj.y=obj.y-this.icon.attr('width')/2;}
if(obj.width){obj.height=obj.width;if(!obj.x&&!obj.y){var icon=this.icon,delta=obj.width-icon.attr('width');obj.x=icon.attr('x')-delta/2;obj.y=icon.attr('y')-delta/2;}}
this.icon.animate(obj,duration);}},'circle':{create:function(stage,x,y,width){return{icon:stage.circle(x,y,width/2),position:this.position,animate:this.animate,size:this.size}},size:function(w){this.icon.attr('r',w/2);},position:function(x,y){if(arguments.length==0){return{x:this.icon.attr('cx'),y:this.icon.attr('cy')}}
this.icon.attr({'cx':x,'cy':y});},animate:function(obj,duration){for(var o in obj){if(o=='x'){obj.cx=obj[o];}else if(o=='y'){obj.cy=obj[o];}else if(o=='width'){obj.r=obj[o]/2;}}
delete obj.x;delete obj.y;delete obj.width;this.icon.animate(obj,duration);}},'triangle':{create:function(stage,x,y,width){return{icon:stage.path().attr({path:['M',x-width/2,y+width/2*Math.tan(PI/6),'l',width/2,-width/2*Math.tan(PI/3),'l',width/2,width/2*Math.tan(PI/3)],'stroke-width':0}),position:this.position,animate:this.animate,size:this.size,x:x,y:y,width:width}},size:function(width){var icon=this.icon,x=this.x,y=this.y;icon.attr('path',['M',x-width/2,y+width/2*Math.tan(PI/6),'l',width/2,-width/2*Math.tan(PI/3),'l',width/2,width/2*Math.tan(PI/3)]);this.width=width;},position:function(x,y){var icon=this.icon,width=this.width;if(arguments.length==0){return{x:this.x,y:this.y}}
icon.attr('path',['M',x-width/2,y+width/2*Math.tan(PI/6),'l',width/2,-width/2*Math.tan(PI/3),'l',width/2,width/2*Math.tan(PI/3)]);},animate:function(obj,duration){var icon=this.icon,width=this.width,x=this.x,y=this.y
if('x'in obj||'y'in obj||'width'in obj){width=(obj.width||width);var path=['M',(obj.x||x)-width/2,(obj.y||y)+width/2*Math.tan(PI/6),'l',width/2,-width/2*Math.tan(PI/3),'l',width/2,width/2*Math.tan(PI/3)]
this.x=(obj.x||x);this.y=(obj.y||y);this.width=width;obj.path=path;}
delete obj.x;delete obj.y;delete obj.width;icon.animate(obj,duration);}},'lozenge':{create:function(stage,x,y,width){return{icon:stage.path().attr({path:['M',x-width/2,y,'l',width/2,-width/2,'l',width/2,width/2,'l',-width/2,width/2,'l',-width/2,-width/2],'stroke-width':0}),position:this.position,animate:this.animate,size:this.size,x:x,y:y,width:width}},size:function(width){var icon=this.icon,x=this.x,y=this.y;icon.attr('path',['M',x-width/2,y,'l',width/2,-width/2,'l',width/2,width/2,'l',-width/2,width/2,'l',-width/2,-width/2]);this.width=width;},position:function(x,y){var icon=this.icon,width=this.width;if(arguments.length==0){return{x:this.x,y:this.y}}
icon.attr('path',['M',x-width/2,y,'l',width/2,-width/2,'l',width/2,width/2,'l',-width/2,width/2,'l',-width/2,-width/2]);},animate:function(obj,duration){var icon=this.icon,width=this.width,x=this.x,y=this.y
if('x'in obj||'y'in obj||'width'in obj){width=(obj.width||width);var path=['M',(obj.x||x)-width/2,(obj.y||y),'l',width/2,-width/2,'l',width/2,width/2,'l',-width/2,width/2,'l',-width/2,-width/2]
this.x=(obj.x||x);this.y=(obj.y||y);this.width=width;obj.path=path;}
delete obj.x;delete obj.y;delete obj.width;icon.animate(obj,duration);}}},defaultIcon='rect';return{defaultIcon:defaultIcon,icons:self.options.icons,create:function(i,x,y,width){var iconType=this.icons[i]||defaultIcon;if(typeof iconType==="string"){return nativeIcons[iconType].create(self.stage,x,y,width);}else if(util.isObject(iconType)){return iconType.create(self.stage,x,y,width);}},nativeIcons:nativeIcons}},_initAxis:function(){var opt=this.options,axisOption=opt.axis,axis,thisAxisOption,range,beginX,beginY,seriesArray=[],thisAxis,coordinate=this.coordinate;for(axis in axisOption){if(!axisOption.hasOwnProperty(axis)){continue;}
if((thisAxisOption=axisOption[axis])){(coordinate.isY(axis)&&!('rotate'in thisAxisOption))&&(thisAxisOption.rotate=90);if(coordinate.isY(axis)&&!axisOption.ticks){seriesArray=coordinate.getRelatedSeries(axis);range=this.series.getRange(seriesArray);thisAxisOption.max===undefined&&(thisAxisOption.max=range.max);thisAxisOption.min===undefined&&(thisAxisOption.min=range.min);}
if(coordinate.isX(axis)){(thisAxisOption.percent===undefined)&&(thisAxisOption.percent=.9);if(!thisAxisOption.ticks){thisAxisOption.ticks=this.series.getLabels();}
if(thisAxisOption.type==DATETIME&&this.series.getLength()>1){var ticks=[];thisAxisOption.ticks.forEach(function(t){ticks.push(util.date.parse(t,thisAxisOption.fromFormat));});ticks.sort(function(a,b){return+a-+b;});thisAxisOption.min=ticks[0];thisAxisOption.max=ticks[ticks.length-1];}else{thisAxisOption.type=DISCRETE;}}
if(coordinate.isY(axis)&&axis!==DEFAULT_Y_AXIS){thisAxisOption.opposite=true;}
thisAxisOption._svgWidth=this.options.width;thisAxisOption._svgHeight=this.options.height;thisAxisOption._name=axis;thisAxis=new Axis(thisAxisOption,this.series,this.stage);coordinate.push(axis,thisAxis);if(thisAxis.model.rotate==0){beginX=Math.min(beginX||opt.width,(opt.width-thisAxis.model.totalWidth)/2);}else if(thisAxis.model.rotate==90){beginY=Math.min(beginY||opt.width,(opt.height-thisAxis.model.totalWidth)/2);}}}
this.coordinate.use(DEFAULT_X_AXIS,DEFAULT_Y_AXIS);for(axis in coordinate.axises){if(!coordinate.axises.hasOwnProperty(axis)){continue;}
thisAxis=coordinate.axises[axis];if(thisAxis.options.opposite){if(thisAxis.model.rotate==90){thisAxis.model.beginX=beginX+coordinate.size().width;thisAxis.model.beginY=opt.height-beginY;}else{thisAxis.model.beginX=beginX;thisAxis.model.beginY=opt.height-beginY-coordinate.size().height;}
if(coordinate.isX(axis)){for(var o in coordinate.axises){if(coordinate.isY(o)){coordinate.axises[o].model.reverse=true;}}}}else{thisAxis.model.beginX=beginX;thisAxis.model.beginY=opt.height-beginY;}}
this.axisRendered=false;},_renderAxis:function(){var o,axises=this.coordinate.axises;for(o in axises){if(axises.hasOwnProperty(o)){axises[o].axisRendered=true;axises[o].autoModel();axises[o].render();}}
this.axisRendered=true;},_initLegend:function(){var opt=this.options,legendOption=opt.legend,coordinate=this.coordinate,series=this.series,legend,axisName,axis,relatedSeries,activeRelatedSeries,range;if(legendOption&&this.series.getSeries().length){legendOption._svgWidth=opt.width;legendOption._svgHeight=opt.height;legendOption.colors=this.colors;legendOption.names=this.labels;legend=this.legend=new Legend(this,legendOption,this.stage);legend.onActiveChange(function(active,activeArray){for(axisName in coordinate.axises){axis=coordinate.axises[axisName];relatedSeries=coordinate.getRelatedSeries(axisName);activeRelatedSeries=[];relatedSeries.forEach(function(i){if(active[i]){activeRelatedSeries.push(i);}});if((!axis.options.ticks||!axis.options.ticks.length)&&activeRelatedSeries.length){range=series.getRange(activeRelatedSeries);axis.set({min:range.min,max:range.max});}}});}},_initGrid:function(){var gridOption=this.options.grid,coordinate=this.coordinate,rows=[],columns=[];function generatePositions(){rows=[];columns=[];if(gridOption.enableRow){if(coordinate.y&&coordinate.y.model.rotate==90){coordinate.y.forEach(function(i,length){rows.push(coordinate.y.model.beginY-length)});gridOption._x=coordinate.x.model.beginX;}else if(coordinate.x&&coordinate.x.model.rotate==90){coordinate.x.forEach(function(i,length){rows.push(coordinate.x.model.beginY-length)});gridOption._x=coordinate.y.model.beginX;}
gridOption.width=coordinate.size().width||0;gridOption.rows=rows;}
if(gridOption.enableColumn){if(coordinate.y&&coordinate.y.model.rotate==0){coordinate.y.forEach(function(i,length){columns.push(coordinate.y.model.beginX+length)});gridOption._y=coordinate.x.model.beginY;}else if(coordinate.x&&coordinate.x.model.rotate==0){coordinate.x.forEach(function(i,length){columns.push(coordinate.x.model.beginX+length)});gridOption._y=coordinate.y.model.beginY;}
gridOption.height=coordinate.size().height||0;gridOption.columns=columns;}}
generatePositions();var grid=this.grid=new Grid(gridOption,this.stage);coordinate.y&&coordinate.y.on(function(){generatePositions();util.mix(grid.options,gridOption);grid.options.rows=gridOption.rows;grid.options.columns=gridOption.columns;grid.render();});},_initThreshold:function(){var options=this.options,coordinate=this.coordinate,threshold=options.threshold,axisName,axis,value;if(threshold&&util.isObject(threshold)){for(var axisName in threshold){if((axis=coordinate.axises[axisName])&&util.isObject(threshold[axisName])&&(value=threshold[axisName].value)){new Threshold(axisName,value,coordinate,this.stage);}}}},_initEvents:function(){var opt=this.options,self=this;if(opt.events){for(var event in opt.events){this.events.on(event,function(){opt.events[event].apply(self,arguments)});}}},_draw:function(){var chart,chartOption;for(chart in charts){if(chartOption=this.options[chart]){charts[chart].draw&&charts[chart].draw.call(this,chartOption);}}},destroy:function(){this.stage&&this.stage.clear();this.stage=null;this.container.innerHTML="";}};Chart.addChart=function(name,methods){charts[name]=methods;};Chart.charts=charts;var Series=function(data){var series=[]
if(isArray(data)){data.forEach(function(d,i){if(isArray(d)){series.push({data:d});}
else if(isObject(d)){if(d.data!==undefined){series.push(d);}else{series.push({data:d});}}else{series.push({data:d});}})}else if(isObject(data)){for(var o in data){series.push({name:o,data:data[o]});}}else{series.push({data:data});}
this.series=series;this.accumulation=false;};Series.prototype={constructor:Series,getRange:function(arr){var series=this.series,accumulation=this.accumulation,max,min;if(!arr){arr=[];this.series.forEach(function(s,i){arr.push(i);});}
arr.forEach(function(index){var d=series[index].data
if(isArray(d)){var iMax=Math.max.apply(Math,d),iMin=Math.min.apply(Math,d);(max===undefined||iMax>max)&&(max=iMax);(min===undefined||iMin<min)&&(min=iMin);}else if(isObject(d)){for(var o in d){(max===undefined||d[o]>max)&&(max=d[o]);(min===undefined||d[o]<min)&&(min=d[o]);}}else{(max===undefined||d>max)&&(max=d);(min===undefined||d<min)&&(min=d);}});if(accumulation){var ac
arr.forEach(function(index,j){var d=series[index].data;if(isArray(d)){ac=ac||[];d.forEach(function(value,i){ac[i]===undefined?ac[i]=value:ac[i]+=value;});}else if(isObject(d)){ac=ac||{};for(var o in d){ac[o]===undefined?ac[o]=d[o]:ac[o]+=d[o];}}else{ac=ac||[];ac[j]=d;}});if(isArray(ac)){max=Math.max.apply(Math,ac);}else if(isObject(ac)){max=undefined;for(var o in ac){(max===undefined||ac[o]>max)&&(max=ac[o]);}}}
return{max:max,min:min}},getSeries:function(){return this.series;},getLabels:function(){var labels=[],_labels={},isObj=false,isArr=false,len=0
this.series.forEach(function(item){if(item.name&&Venus.util.isNumber(item.data)){labels.push(item.name)}
else{var data=item.data;if(isArray(data)){isArr=true;len=Math.max(data.length,len)}
else if(isObject(data)){for(var o in data){isObj=true;_labels[o]=true;}}else{labels.push('');}}});if(isObj){labels=[];for(var o in _labels){labels.push(o);}}
if(isArr){labels=new Array(len);for(var i=0;i<len;i++){labels[i]=''}}
return labels;},getLength:function(){var length=0,series=this.series;if(series.length){if(util.isNumber(series[0].data)){length=series.length;}else if(util.isArray(series[0].data)){var l=[];series.forEach(function(i){l.push(i.length);});length=Math.max.apply(Math,l);}else if(util.isObject(series[0].data)){var l=[],o;series.forEach(function(s,i){l[i]=0;for(o in s.data){l[i]++;}});length=Math.max.apply(Math,l);}}
return length;}}
var Axis=function(options,series,paper){var defaultOptions={percent:0.8,total:0,max:0,min:0,tickSize:0,tickWidth:0,ticks:[],rotate:0,pop:0,opposite:false,_svgWidth:0,_svgHeight:0,_name:'',type:CONTINUOUS,toFormat:"",fromFormat:"",labelRotate:0,labelPosition:UNDER_TICK,enable:true,fontSize:12};this.options=mix(defaultOptions,options||{});this.implement(this.options.type);this.name=this.options._name;this.stage=paper;this.events=new Venus.util.CustomEvent();this.model={};this.view={};this.events=new util.CustomEvent();this.autoModel();}
Axis.prototype={constructor:Axis,autoModel:function(){},set:function(key,value){var change=false;if(isObject(key)){for(var o in key){if(!key.hasOwnProperty(o)){continue;}
if(this.options[o]!=key[o]){this.options[o]=key[o];change=true;}}}else{if(this.options[key]!==value){this.options[key]=value;change=true;}}
if(change){this.autoModel();}
if(change&&this.axisRendered){this.render();this.events.fire('model_change',this.model);}},autoRange:function(min,max,totalTick){(min===undefined||min===null||isNaN(min))&&(min=0);(max===undefined||max===null||isNaN(max))&&(max=10);var iDelta=max-min,iExp,iMultiplier,dSolution,dMultiCal,dInterval,start,end;totalTick=totalTick||5;if(iDelta==0){if(min==0&&max==0){return{min:0,max:10,total:2,step:10}}
return{max:max,min:max-Math.abs(max),total:2,step:Math.abs(max)}}
iExp=parseInt(Math.log(iDelta)/Math.log(10))-2;iMultiplier=Math.pow(10,iExp);dSolution=[1,2,2.5,5,10,20,25,50,100,200,250,500,1000,5000];for(var i=0,l=dSolution.length;i<l;i++){dMultiCal=iMultiplier*dSolution[i];if((parseInt(iDelta/dMultiCal)+1)<=totalTick){break;}}
dInterval=iMultiplier*dSolution[i];start=Math.abs(min)==dInterval?(min-dInterval):util.number.multiple(Math.floor(min/dInterval),dInterval);for(i=0;1;i++){if(start+dInterval*i>max)
break;end=util.number.add(start,dInterval*(i+1));}
return{max:end,min:start,step:dInterval,total:Math.round((end-start)/dInterval)+1}},render:function(){var view=this.view,model=this.model,stage=this.stage,opt=this.options,pathAttr={'opacity':.8,'stroke-width':1},pathString=[],beginX=model.beginX,beginY=model.beginY,tickHeight=2,labelMarginTop=5,label,bbox,skip,noOppositeLabel=((model.rotate==0)!==opt.opposite),reverse=!!model.reverse,transformString="";if(!view.axisElement){view.axisElement=stage.path();}
if(view.tickElements){view.tickElements.forEach(function(t){t.remove();});view.tickElements.clear();}else{view.tickElements=stage.set();}
if(view.labelElements){view.labelElements.forEach(function(label){label.remove();});view.labelElements.clear();}else{view.labelElements=stage.set();}
pathString.push('M',beginX,beginY,'h',model.totalWidth);this.forEach(function(i,length,text){if(i!==0){view.tickElements.push(stage.path().attr({path:['M',beginX+length,beginY,'v',tickHeight]}).attr(pathAttr));}
if(text!==undefined&&(!skip||skip<=1||(i-model.pop)%skip==0)){var distance=(opt.labelPosition==UNDER_TICK?0:model.tickWidth/2);label=stage.text(reverse?(beginX+model.totalWidth-length+distance):(beginX+length-distance),beginY,text).attr({'font-size':this.options.fontSize});view.labelElements.push(label);bbox=label.getBBox();var line=Math.sqrt(Math.pow(bbox.width,2)+Math.pow(bbox.height,2)),totalRotate=((opt.labelRotate||0)+(model.rotate||0))*PI/180,t=Math.max(bbox.height,line*Math.cos(totalRotate));skip=Math.ceil((t+20)/model.tickWidth);}});view.axisElement.attr({path:pathString}).attr(pathAttr);if(model.rotate){transformString+=('R'+(-model.rotate)+','+beginX+','+beginY);}
if(transformString){view.axisElement.transform(transformString);view.tickElements.transform(transformString);}
view.labelElements.forEach(function(l){var str="",bBox=l.getBBox(),line=Math.sqrt(Math.pow(bBox.width,2)+Math.pow(bBox.height,2)),totalRotate=((opt.labelRotate||0)+(model.rotate||0))*PI/180,t=(Math.max(bBox.height,line*Math.sin(totalRotate))/2+labelMarginTop)*(noOppositeLabel?1:-1);if(model.rotate){str+=("R90");}
if(opt.labelRotate){str+=("...R"+opt.labelRotate);}
str+=('T0,'+t);if(model.rotate){str+=("...R-90,"+beginX+","+beginY);}
if(str){l.transform(str);}});if(!this.options.enable){view.axisElement.hide();view.labelElements.hide();view.tickElements.hide();}},on:function(fn){this.events.on('model_change',fn);},implement:function(type){if(Axis.types[type]){for(var m in Axis.types[type]){this[m]=Axis.types[type][m];}}}};Axis.types={'continuous':{autoModel:function(){var opt=this.options,model=this.model,alpha=Math.atan(opt._svgHeight/opt._svgWidth),beta=(opt.rotate||0)*PI/180,percent=opt.percent,maxWidth=beta<=alpha?opt._svgWidth/Math.cos(beta):opt._svgHeight/Math.sin(beta);model.pop=opt.pop||0;model.rotate=opt.rotate;var range=this.autoRange(opt.min,opt.max,opt.total);model.max=range.max;model.min=range.min;model.tickSize=range.step;model.desc=range.desc;model.total=range.total;model.tickWidth=opt.tickWidth||maxWidth*percent/(model.total+model.pop-1);model.totalWidth=model.tickWidth*(model.total+model.pop-1);},getPoint:function(value){var model=this.model,length;length=value===undefined?0:(value-model.min)*model.tickWidth/model.tickSize+model.pop*model.tickWidth;return{length:length,tick:value}},forEach:function(fn){var model=this.model,distance,i,l,count=0;for(i=0,l=model.pop;i<l;i++){fn.call(this,i,(i+1)*model.tickWidth)}
for(i=model.min,l=model.max;i<=l;){distance=(count+model.pop)*model.tickWidth;fn.call(this,model.pop+count,distance,l>=1000&&i/100===parseInt(i/100)&&i!==0?i/1000+'k':i);i=util.number.add(i,model.tickSize);count++;}}},'discrete':{autoModel:function(){var opt=this.options,model=this.model,alpha=Math.atan(opt._svgHeight/opt._svgWidth),beta=(opt.rotate||0)*PI/180,percent=opt.percent,maxWidth=beta<=alpha?opt._svgWidth/Math.cos(beta):opt._svgHeight/Math.sin(beta),total,i,l;model.pop=opt.pop||0;model.rotate=opt.rotate;if(opt.tickSize){model.tickSize=opt.tickSize;}else{if(opt.total){total=Math.min(opt.total,opt.ticks.length);}else{total=opt.ticks.length;while(total){if(opt.fontSize*(total+model.pop)>maxWidth*percent){total=Math.floor(total/2);}else{break;}}}
if(total==1){total=2;model.pop=1;}
model.tickSize=Math.ceil((opt.ticks.length-1)/(total-1))||1;}
total=Math.ceil((opt.ticks.length-1)/model.tickSize)+1;model.tickWidth=parseInt(opt.tickWidth||maxWidth*percent/(total+model.pop-1));model.totalWidth=model.tickWidth*(total+model.pop-1);model.total=total;},getPoint:function(key){var tick,length,model=this.model,options=this.options
if(key===undefined){length=0;}else{if(typeof key=="string"){tick=key;options.ticks.forEach(function(tick,i){if(tick==key){key=i;}});}else{tick=options.ticks[key];}
length=key*model.tickWidth/model.tickSize+model.pop*model.tickWidth;}
return{length:length,tick:tick}},forEach:function(fn){var model=this.model,opt=this.options,distance,i,l,count=0;for(i=0,l=model.pop;i<l;i++){fn.call(this,i,(i+1)*model.tickWidth)}
for(i=0,l=opt.ticks.length-1;i<=l;){distance=(count+model.pop)*model.tickWidth
fn.call(this,model.pop+count,distance,opt.ticks[i]);i=util.number.add(i,model.tickSize);count++;}}},'datetime':{autoModel:function(){Axis.types.continuous.autoModel.call(this);},autoRange:function(a,b){var min=a?(+a):(+new Date()),max=b?(+b):(+new Date()),iDelta=max-min,step,total,desc,aSecond=1000,aMinute=60*aSecond,aHour=60*aMinute,aDay=24*aHour,minTime=new Date(min),maxTime=new Date(max);if(iDelta==0){return{max:max,min:0,step:max,total:2}}else if(iDelta<aSecond*2){}else if(iDelta<aMinute*2){min=minTime.setMilliseconds(0);max=maxTime.getMilliseconds()===0?max:maxTime.setSeconds(maxTime.getSeconds()+1);step=aSecond;desc="second";total=(max-min)/step+1;}else if(iDelta<aHour*2){min=minTime.setSeconds(0,0);max=+(new Date(max).setSeconds(0,0))<max?maxTime.setMinutes(maxTime.getMinutes()+1,0,0):max;step=aMinute;desc="minute";total=(max-min)/step+1;}else if(iDelta<aDay*2){min=minTime.setMinutes(0,0,0);max=+(new Date(max).setMinutes(0,0,0))<max?maxTime.setHours(maxTime.getHours()+1,0,0,0):max;step=aHour;desc="hour";total=(max-min)/step+1;}else if(new Date(min).setMonth(minTime.getMonth()+2)>max){min=minTime.setHours(0,0,0,0);max=+(new Date(max).setHours(0,0,0,0))<max?+new Date(maxTime.getFullYear(),maxTime.getMonth(),maxTime.getDate()+1):max;step=aDay;desc="day";total=(max-min)/step+1;}else if(new Date(min).setFullYear(minTime.getFullYear()+2)>max){min=+new Date(minTime.getFullYear(),minTime.getMonth(),1);max=+new Date(maxTime.getFullYear(),maxTime.getMonth())<maxTime?+new Date(maxTime.getFullYear(),maxTime.getMonth()+1):maxTime;minTime=new Date(min);maxTime=new Date(max);desc="month";total=(maxTime.getFullYear()-minTime.getFullYear())*12+maxTime.getMonth()-minTime.getMonth()+1;}else{min=+new Date(minTime.getFullYear());max=+new Date(maxTime.getFullYear(),0)<maxTime?+new Date(maxTime.getFullYear()+1):maxTime;minTime=new Date(min);maxTime=new Date(max);desc="year";total=maxTime.getFullYear()-minTime.getFullYear()+1;}
return{max:max,min:min,step:step,total:total,desc:desc}},getPoint:function(date){var value=+util.date.parse(date),model=this.model,length;length=value===undefined?0:(value-model.min)*(model.totalWidth-model.pop*model.tickWidth)/(model.max-model.min)+model.pop*model.tickWidth;return{length:length,tick:util.date.format(new Date(value),this.options.toFormat)}},forEach:function(fn){var model=this.model,distance,format,i,l,count=0,date,monthMap=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];for(i=0,l=model.pop;i<l;i++){fn.call(this,i,(i+1)*model.tickWidth)}
if(model.tickSize){switch(model.desc){case"second":format="ss";break;case"minute":format="mm:ss";break;case"hour":format="hh:mm";break;case"day":format="MM-dd";break;}
for(i=model.min,l=model.max;i<=l;){distance=(count+model.pop)*model.tickWidth;fn.call(this,model.pop+count,distance,util.date.format(i,format));i=util.number.add(i,model.tickSize);count++;}}else{date=new Date(model.min);if(model.desc=="month"){while(+date<=model.max){distance=this.getPoint(date).length;fn.call(this,model.pop+count,distance,monthMap[date.getMonth()]);date=new Date(date.setMonth(date.getMonth()+1));count++;}}else if(model.desc=="year"){while(+date<=model.max){distance=(count+model.pop)*model.tickWidth;fn.call(this,model.pop+count,distance,date.getFullYear());date=new Date(date.setFullYear(date.getFullYear()+1));count++;}}}}}};Axis.extendType=function(type,methods){Axis.types=methods;};var Legend=function(chart,options,paper){var defaultOption={position:['right','top'],format:'{name}',fontSize:12,colors:[],borderWidth:.8,borderColor:'gray',direction:'vertical'},i,l,series=chart.series,data=series.getSeries(),width=15,lineHeight=20,span=10,border,startX=0,startY=0,item,icon,text,textWidth,totalWidth,totalHeight,itemSet,textSet,margin=10,padding=10,names,colors,isVertical,_x,_y,left,top,active,activeEvent,activeArray,self=this,opt=this.options=mix(defaultOption,options);itemSet=paper.set();textSet=paper.set();colors=opt.colors;names=options.names;isVertical=(opt.direction=='vertical');isVertical?totalWidth=[]:totalWidth=0;startX=padding;startY=padding;for(i=0,l=data.length;i<l;i++){_x=startX;_y=startY;icon=chart.iconFactory.create(i,_x+width/2,_y+lineHeight/2,width);item=icon.icon;item._iconObj=icon;text=paper.text(_x+width+span,_y+lineHeight/2,names[i]).attr({'font-size':opt.fontSize});textWidth=text.getBBox().width;text.translate(textWidth/2,0);isVertical?startY+=lineHeight:startX+=(width+span*2+textWidth);item.attr({'fill':colors[i],'stroke-width':0,'cursor':'pointer'});itemSet.push(item);textSet.push(text);isVertical?totalWidth.push(textWidth):totalWidth+=textWidth;}
totalWidth=isVertical?Math.max.apply(Math,totalWidth)+width+span+padding*2:width*l+(2*l-1)*span+padding*2+totalWidth;totalHeight=isVertical?lineHeight*l+padding*2:padding*2+lineHeight;var _lastX,_lastY;border=paper.rect(0,0,totalWidth,totalHeight,5).attr({'stroke-width':opt.borderWidth,'stroke':opt.borderColor,'fill':"#FFF",'cursor':'move'}).drag(function(dx,dy){var shiftX=dx-_lastX,shiftY=dy-_lastY;self.setPosition(shiftX,shiftY);_lastX=dx;_lastY=dy;},function(){_lastX=0;_lastY=0;self.toFront();});this.border=border;this.itemSet=itemSet;this.textSet=textSet;this.toFront();if(typeof(left=this.options.position[0])=="string"){if(left=="right"){left=this.options._svgWidth-totalWidth-margin;}else if(left=="center"){left=this.options._svgWidth/2-totalWidth/2}else{left=margin}}
if(typeof(top=this.options.position[1])=="string"){if(top=="bottom"){top=this.options._svgHeight-totalHeight-margin}else if(top=='center'){top=this.options._svgHeight/2-totalHeight/2}else{top=margin}}
this.setPosition(left,top);active=this.active=[];itemSet.forEach(function(){active.push(true);});activeArray=this.activeArray=active.slice(0);activeEvent=this.activeEvent=new util.CustomEvent();this.on('click',function(e,i){active[i]?active[i]=false:active[i]=true;active[i]?this.attr('fill',colors[i]):this.attr('fill','gray');activeArray=self.activeArray=[];active.forEach(function(truth,index){truth&&activeArray.push(index);});activeEvent.fire('change',active,activeArray);});};Legend.prototype={constructor:Legend,setPosition:function(left,top){this.itemSet.translate(left,top);this.textSet.translate(left,top);this.border.translate(left,top);},on:function(name,fn){var event;if((event=this.itemSet[name])&&util.isFunction(event)){this.itemSet.forEach(function(item,i){item[name](function(e){fn.call(item,e,i);});})}
return this;},onActiveChange:function(fn){this.activeEvent.on('change',fn);},toFront:function(){this.border.toFront();this.itemSet.toFront();this.textSet.toFront();}}
var Grid=function(options,paper){var defaultOption={'color':'#ccc','rows':[],'columns':[],'width':0,'height':0,'stroke-width':1,'opacity':0.2,_x:0,_y:0};this.options=mix(defaultOption,options);this.paper=paper;this.rows=paper.set();this.columns=paper.set();this.render();}
Grid.prototype={constructor:Grid,render:function(){this.rows.forEach(function(r){r.remove();}).clear();this.columns.forEach(function(c){c.remove();}).clear();var options=this.options,paper=this.paper,lineAttr={stroke:options.color,"stroke-width":options['stroke-width'],'opacity':options.opacity},self=this;if(options.rows&&options.rows.length){options.rows.forEach(function(value){self.rows.push(paper.path('M'+options._x+","+value+"h"+options.width).attr(lineAttr));});self.rows.toBack();}
if(options.columns&&options.columns.length){options.columns.forEach(function(value){self.columns.push(paper.path('M'+value+","+options._y+"v"+-options.height).attr(lineAttr));});self.columns.toBack();}}}
var Threshold=function(axisName,value,coordinate,stage){this.axisName=axisName;this.stage=stage;this.axis=coordinate.axises[axisName];this.type=coordinate.type(axisName);this.value=value;this.coordinate=coordinate;this.render();}
Threshold.prototype={constructor:Threshold,render:function(){var width,coordinate=this.coordinate,triangleWidth=10,pos=this.getPosition(this.value);width=this.type=='x'?coordinate.y.model.totalWidth:coordinate.x.model.totalWidth;this.line=this.stage.path().attr({path:['M',pos.x,pos.y,'v',-triangleWidth/2,'l',triangleWidth,triangleWidth/2,'h',width-triangleWidth,'m',triangleWidth-width,0,'l',-triangleWidth,triangleWidth/2,'v',-triangleWidth/2],'fill':'red','stroke':'red'});},moveTo:function(value){},getPosition:function(value){var coordinate=this.coordinate,x=coordinate.xName,y=coordinate.yName,xy;if(this.type==="x"){coordinate.use(this.axisName,y);xy=coordinate.get(value);coordinate.use(x,y);return{x:xy.x,y:xy.y}}else{coordinate.use(x,this.axisName);xy=coordinate.get(undefined,value);coordinate.use(x,y);return{x:xy.x,y:xy.y}}}}
var toolTip=function(paper,x,y,texts,side){var tip,labels,side=side||'top',path=function(width,height,padding,side){var p=[],arrowWidth=5,left,top;height+=(2*padding||0);width+=(2*padding||0);switch(side){case'right':height=Math.max(arrowWidth*2,height);p.push('M',x+10,y);p.push('l',arrowWidth,-arrowWidth);p.push('v',-(height/2-arrowWidth));p.push('h',width);p.push('v',height,'h',-width);p.push('v',-(height/2-arrowWidth));p.push('l',-arrowWidth,-arrowWidth);left=x+10+arrowWidth;top=y-height/2;break;case'top':width=Math.max(arrowWidth*2,width);p.push('M',x,y-10);p.push('l',-arrowWidth,-arrowWidth);p.push('h',-(width/2-arrowWidth));p.push('v',-height,'h',width,'v',height);p.push('h',-(width/2-arrowWidth));p.push('l',-arrowWidth,arrowWidth);left=x-width/2;top=y-10-arrowWidth-height;break;case'left':height=Math.max(arrowWidth*2,height);p.push('M',x-10,y);p.push('l',-arrowWidth,arrowWidth);p.push('v',height/2-arrowWidth);p.push('h',-width,'v',-height,'h',width);p.push('v',height/2-arrowWidth);p.push('l',arrowWidth,arrowWidth);left=x-10-arrowWidth-width;top=y-height/2;break;case'bottom':width=Math.max(arrowWidth*2,width);p.push('M',x,y+10);p.push('l',arrowWidth,arrowWidth);p.push('h',width/2-arrowWidth);p.push('v',height,'h',-width,'v',-height);p.push('h',width/2-arrowWidth);p.push('l',arrowWidth,-arrowWidth);left=x-width/2;top=y+10+arrowWidth;break;}
p.push('z');return{path:p,box:{left:left,top:top,width:width,height:height}};}!isArray(texts)&&(texts=[texts]);labels=paper.set();var width=[],height=0,bBox,text,paddingToBorder=8,p,totalWidth,totalHeight;texts.forEach(function(t,i){text=paper.text(x,-100,t);labels.push(text);bBox=util.clone(text.getBBox());bBox.width+=(t.toString().split(' ').length*10)
text.attr({'opacity':0,'font-size':12});width.push(bBox.width);});if(this._venus_tooltip_show)
return;totalWidth=Math.max.apply(Math,width);totalHeight=texts.length*bBox.height;p=path(totalWidth,totalHeight,paddingToBorder,side);if(p.box.left+p.box.width>paper.canvas.clientWidth){p=path(totalWidth,totalHeight,paddingToBorder,'left');}else if(p.box.left<0){p=path(totalWidth,totalHeight,paddingToBorder,'right');}else if(p.box.top<0){p=path(totalWidth,totalHeight,paddingToBorder,'bottom');}else if(p.box.top+p.box.height>paper.canvas.clientHeight){p=path(totalWidth,totalHeight,paddingToBorder,'top');}
tip=paper.path();labels.toFront();tip.attr({path:p.path,fill:"#FFF","stroke-width":2,"fill-opacity":.1,'stroke-linejoin':'round','stroke':'#4572A7','opacity':'0'});tip.animate({'opacity':1,'fill-opacity':.85},100);labels.animate({'opacity':1},100);labels.forEach(function(la,i){la.attr({'y':p.box.top+(i+.5)*bBox.height+paddingToBorder,'x':p.box.left+p.box.width/2})});this._venus_tooltip_labels=labels;this._venus_tooltip=tip;this._venus_tooltip_show=true;return toolTip;},toolTipHide=function(){var self=this,cb=function(){this.remove();self._venus_tooltip_show=false;},animate=Raphael.animation({'opacity':0},100,'linear',cb);this._venus_tooltip&&(this._venus_tooltip.animate(animate))&&(this._venus_tooltip_labels.animate(animate));};Raphael.el.toolTip=toolTip;Raphael.el.toolTipHide=toolTipHide;Chart.Series=Series;Chart.Axis=Axis;Chart.Legend=Legend;Chart.Grid=Grid;Venus.SvgChart=Chart;})(this);;;(function(Chart,undefined){function getAnchors(p1x,p1y,p2x,p2y,p3x,p3y){var l1=(p2x-p1x)/2,l2=(p3x-p2x)/2,a=Math.atan((p2x-p1x)/Math.abs(p2y-p1y)),b=Math.atan((p3x-p2x)/Math.abs(p2y-p3y));a=p1y<p2y?Math.PI-a:a;b=p3y<p2y?Math.PI-b:b;var alpha=Math.PI/2-((a+b)%(Math.PI*2))/2,dx1=l1*Math.sin(alpha+a),dy1=l1*Math.cos(alpha+a),dx2=l2*Math.sin(alpha+b),dy2=l2*Math.cos(alpha+b);return{x1:p2x-dx1,y1:p2y+dy1,x2:p2x+dx2,y2:p2y+dy2};}
Chart.addChart('line',{draw:function(){var util=Venus.util,opt=this.options,lineOpt=util.mix({'line-width':2,smooth:false,dots:true,dotRadius:1,hoverRadius:50,area:false,areaOpacity:0.1,beginAnimate:false,dotSelect:true,columnHover:false},opt.line),dotRadius=lineOpt.dotRadius,series=this.series,data=series.getSeries(),self=this,raphael=this.stage,colors=this.colors,elements=[],coordinate=self.coordinate;function pointBindModel(x,y){function set(){var xy=coordinate.get(x,y);point.x=xy.x;point.y=xy.y;point.xTick=xy.xTick;point.yTick=xy.yTick;}
var point={};coordinate.y.on(set);set();return point;}
function activeDot(dot){var icon=dot._iconObj,point=dot.data('point');if(dot._selected_||dot.node.style.display==="none"||dot._active_){return;}
dot._active_=true;icon.animate({width:lineOpt.dotRadius*4},100);dot.toolTip(raphael,icon.position().x,icon.position().y,self.options.tooltip.call(self,{x:point.xTick,y:point.yTick,label:point.label}));}
function inActiveDot(dot){var icon=dot._iconObj,point=dot.data('point');if(dot._selected_||!dot._active_){return;}
dot._active_=false;icon.animate({width:dotRadius*2},100);dot.toolTipHide();}
function drawLine(arr,indexOfSeries,color,dotColor,label){coordinate.use(coordinate.getAxisUse(indexOfSeries));var points=[],isH=coordinate.x.model.rotate==90&&coordinate.y.model.rotate==0;if(util.isArray(arr)){arr.forEach(function(d,i){var value,point;if(util.isObject(d)){value=d.data;label=self.labels[i];}else{value=d;}
if(value===undefined||value===null||isNaN(value)){return;}
point=pointBindModel(i,value);point.label=label;points.push(point);});}else{for(var o in arr){var value=arr[o];if(value===undefined||value===null||isNaN(value)){continue;}
var point=pointBindModel(o,value)
point.label=label;points.push(point);}}
if(!points.length){elements.push({});return;}
points.sort(function(a,b){if(isH){return b.y-a.y;}
return a.x-b.x;});var pathString,areaPathString,pathAnimateString,areaPathAnimateString;points.length<=2&&(lineOpt.smooth=false);function path(){coordinate.use(coordinate.getAxisUse(indexOfSeries));if(lineOpt.smooth){var x,y,i,l,x0,y0,x1,y1,p;pathString=['M',points[0].x,points[0].y,'C',points[0].x,points[0].y];areaPathString=['M',points[0].x,coordinate.y.model.beginY,'V',points[0].y,'C',points[0].x,points[0].y];lineOpt.beginAnimate&&(pathAnimateString=['M',points[0].x,coordinate.y.model.beginY]);lineOpt.beginAnimate&&(areaPathAnimateString=['M',points[0].x,coordinate.y.model.beginY]);for(i=1,l=points.length-1;i<l;i++){x0=points[i-1].x;y0=points[i-1].y;x=points[i].x;y=points[i].y;x1=points[i+1].x;y1=points[i+1].y;p=getAnchors(x0,y0,x,y,x1,y1);pathString.push(p.x1,p.y1,x,y,p.x2,p.y2);areaPathString.push(p.x1,p.y1,x,y,p.x2,p.y2);lineOpt.beginAnimate&&pathAnimateString.push('H',x)&&areaPathAnimateString.push('H',x);}
pathString.push(x1,y1,x1,y1);areaPathString.push(x1,y1,x1,y1,'V',coordinate.y.model.beginY,'H',points[0].x,'Z');lineOpt.beginAnimate&&pathAnimateString.push('H',x1);}else{pathString=['M',points[0].x,points[0].y];areaPathString=['M',points[0].x,coordinate.y.beginY,'V',points[0].y]
lineOpt.beginAnimate&&(pathAnimateString=['M',points[0].x,coordinate.y.model.beginY]);lineOpt.beginAnimate&&(areaPathAnimateString=['M',points[0].x,coordinate.y.model.beginY]);points.forEach(function(d){pathString.push('L',d.x,d.y);areaPathString.push('L',d.x,d.y);lineOpt.beginAnimate&&pathAnimateString.push('H',d.x);lineOpt.beginAnimate&&areaPathAnimateString.push('H',d.x);});areaPathString.push('V',coordinate.y.model.beginY,'H',points[0].x,'Z');}}
path();var line=raphael.path().attr({'stroke-width':lineOpt['line-width'],'stroke':color,'path':pathAnimateString||pathString}),dots=raphael.set(),area;if(lineOpt.beginAnimate){line.animate({'path':pathString},1000);}
if(lineOpt.area){area=raphael.path().attr({'stroke-width':0,'path':areaPathAnimateString||areaPathString,'fill':color,'opacity':lineOpt.areaOpacity});if(lineOpt.beginAnimate){area.animate({'path':areaPathString},1000);}}
if(lineOpt.dots){if(coordinate.x.model.tickWidth/coordinate.x.model.tickSize<4*dotRadius){dotRadius=coordinate.x.model.tickWidth/coordinate.x.model.tickSize/4;}
points.forEach(function(d,i){var icon=self.iconFactory.create(indexOfSeries,d.x,d.y,dotRadius*2),dot=icon.icon.attr({'fill':dotColor||colors[i],'stroke':'none'}).hover(function(){activeDot(this);},function(){inActiveDot(this);}).data('point',d);dot._iconObj=icon;if(lineOpt.beginAnimate){icon.position(icon.position().x,coordinate.y.model.beginY);icon.animate({'y':d.y},1000);}
if(lineOpt.dotSelect){dot.click(function(){if(!this._selected_){this.toolTip(raphael,icon.position().x,icon.position().y,self.options.tooltip.call(self,{x:d.xTick,y:d.yTick,label:d.label}));this._selected_=true;}else{this._selected_=false;this.toolTipHide();}})}
dots.push(dot);});}
elements.push({line:line,dots:dots,area:area});coordinate.y&&coordinate.y.on(function(){var duration=500;path();line.animate({path:pathString},duration);dots.forEach(function(dot,i){dot._iconObj.animate({x:points[i].x,y:points[i].y},duration);});area&&area.animate({path:areaPathString},duration);});}
function bindLegendEvents(){self.legend&&self.legend.onActiveChange(function(active,activeArray){active.forEach(function(truth,i){if(truth){try{elements[i].line.show();elements[i].dots.show();elements[i].area&&elements[i].area.show();}catch(e){}}else{try{elements[i].line.hide();elements[i].dots.hide();elements[i].area&&elements[i].area.hide();}catch(e){}}});});}
if(data[0]){if(util.isNumber(data[0].data)){drawLine(data,0,this.colors[0],undefined);}else if(util.isArray(data[0].data)){data.forEach(function(item,i){drawLine(item.data,i,colors[i],colors[i],self.labels[i]);});bindLegendEvents();}else if(util.isObject(data[0].data)){data.forEach(function(item,i){drawLine(item.data,i,colors[i],colors[i],self.labels[i]);});bindLegendEvents();}
coordinate.useDefault();if(lineOpt.area){elements.forEach(function(el){el.dots&&el.dots.forEach(function(dot){dot.toFront();});})}
if(lineOpt.dots&&((lineOpt.hoverRadius&&lineOpt.hoverRadius>dotRadius)||lineOpt.columnHover)){var handler=function(e){var offsetX,offsetY,boundBox,minDot,min;boundBox=self.stardBox.node.getBoundingClientRect();offsetX=e.clientX-boundBox.left;offsetY=e.clientY-boundBox.top;if(!lineOpt.columnHover){elements.forEach(function(element){element.dots&&element.dots.forEach(function(dot){var point=dot.data('point'),distance=Math.sqrt(Math.pow((point.x-offsetX),2)+Math.pow((point.y-offsetY),2));if(dot.node.style.display!=="none"&&distance<=lineOpt.hoverRadius&&(distance<=min||min===undefined)){minDot=dot;min=distance;}});});elements.forEach(function(element){element.dots&&element.dots.forEach(function(dot){dot!==minDot&&inActiveDot(dot);});});minDot&&activeDot(minDot);}else{minDot=[];elements.forEach(function(element){element.dots&&element.dots.forEach(function(dot){var point=dot.data('point'),distance=Math.abs(point.x-offsetX);if(distance<=coordinate.x.model.tickWidth&&(distance<min||min===undefined)){minDot=[dot];min=distance;}else if(distance==min){minDot.push(dot);}});});elements.forEach(function(element){element.dots&&element.dots.forEach(function(dot){minDot.indexOf(dot)==-1&&inActiveDot(dot);});});minDot.forEach(function(dot){activeDot(dot);});}}
if(document.addEventListener){raphael.canvas.addEventListener('mousemove',handler,false);}else{raphael.canvas.attachEvent('onmousemove',handler);}}}}});})(Venus.SvgChart);;;(function(){var util=Venus.util;Venus.SvgChart.addChart('bar',{draw:function(){var series=this.series.getSeries(),colors=this.colors,coordinate=this.coordinate,paper=this.stage,sideBySide="sidebyside",nestification="nestification",sumY=[],barOptions=util.mix({radius:0,beginAnimate:true,opacity:1,multiple:sideBySide},this.options.bar),elements=[],self=this,duration=500;coordinate.x.set('pop',1);function drawBar(x,y,width,height,color,tipObj){var bar,distance=coordinate.distance(coordinate.x,{x:x,y:y});if(barOptions.beginAnimate){if(isHorizontal()){if(distance>=0){bar=paper.rect(x,y,0,height,barOptions.radius).animate({width:width},500);}else{bar=paper.rect(coordinate.x.model.beginX,y,0,height,barOptions.radius).animate({width:width,x:x},500);}}else{bar=paper.rect(x,coordinate.x.model.beginY,width,0,barOptions.radius).animate({height:height,y:y},500);}}else{bar=paper.rect(x,y,width,height,barOptions.radius);}
bar.attr({'fill':color,'stroke-width':0,'opacity':barOptions.opacity||1}).hover(function(e){if(isHorizontal()){if(distance>=0){this.toolTip(paper,this.attr('x')+this.attr('width'),this.attr('y')+this.attr('height')/2,self.options.tooltip.call(self,tipObj),'right');}else{this.toolTip(paper,this.attr('x'),this.attr('y')+this.attr('height')/2,self.options.tooltip.call(self,tipObj),'left');}}else{if(distance>=0){this.toolTip(paper,this.attr('x')+this.attr('width')/2,this.attr('y')+this.attr('height'),self.options.tooltip.call(self,tipObj),"bottom");}else{this.toolTip(paper,this.attr('x')+this.attr('width')/2,this.attr('y'),self.options.tooltip.call(self,tipObj),"top");}}},function(){this.toolTipHide();});return bar;}
function bindLegendEvents(){self.legend&&self.legend.onActiveChange(function(active,activeArray){active.forEach(function(truth,i){truth?elements[i].show():elements[i].hide();});render(activeArray);});}
function getPositions(x,y,i,count,sumY){var xy=coordinate.get(x,y),oX=xy.x,oY=xy.y,xModel=coordinate.x.model,xTickWidth=xModel.tickWidth,totalWidth=xModel.totalWidth,beginY=xModel.beginY,beginX=xModel.beginX,times=5,distance;distance=coordinate.distance(coordinate.x,xy);if(barOptions.multiple==sideBySide){var total=((totalWidth-xModel.pop*xModel.tickWidth)||totalWidth)/self.series.getLength()*.8,space=total/((times+1)*count+1),bWidth=times*space;if(isHorizontal()){distance<0?(x=oX):(x=beginX);return{x:x,y:oY-total/2+i*bWidth+(i+1)*space+xTickWidth/2,width:Math.abs(distance),height:bWidth,xTick:xy.xTick,yTick:xy.yTick}}else{distance<0?(y=oY):(y=beginY);x=oX-total/2+i*bWidth+(i+1)*space;return{x:x-xTickWidth/2,y:y,width:bWidth,height:Math.abs(distance),xTick:xy.xTick,yTick:xy.yTick}}}else{if(isHorizontal()){distance<0?(x=oX-sumY):(x=beginX+sumY);return{x:x,y:oY+xTickWidth/4,width:Math.abs(distance),height:xTickWidth/2,xTick:xy.xTick,yTick:xy.yTick}}else{distance<0?(y=oY-sumY):(y=beginY+sumY);return{x:oX-xTickWidth/4-xTickWidth/2,y:y,width:xTickWidth/2,height:Math.abs(distance),xTick:xy.xTick,yTick:xy.yTick}}}}
function isHorizontal(){return coordinate.x.model.rotate==90&&coordinate.y.model.rotate==0;}
if(barOptions.multiple==nestification){this.series.accumulation=true;var range=this.series.getRange();coordinate.y.set({min:range.min,max:range.max})}
function render(seriesArray){if(!seriesArray){seriesArray=[];series.forEach(function(d,i){seriesArray.push(i);});}
sumY=[];if(util.isNumber(series[0].data)){coordinate.use(coordinate.getAxisUse(0));series.forEach(function(d,i){var p=getPositions(i,d.data,0,1);if(elements[i]){elements[i].animate({x:p.x,y:p.y,width:p.width,height:p.height},duration);}else{elements[i]=drawBar(p.x,p.y,p.width,p.height,colors[i],{x:p.xTick,y:p.yTick,label:self.labels[i]});}});}else if(util.isArray(series[0].data)){series.forEach(function(d,i){coordinate.use(coordinate.getAxisUse(i));var indexOfI=seriesArray.indexOf(i),xTickWidth=coordinate.x.model.tickWidth;if(indexOfI==-1){return;}
elements[i]=elements[i]||paper.set();d.data.forEach(function(value,j){sumY[j]=sumY[j]||0;var p=getPositions(j,value,indexOfI,seriesArray.length,sumY[j]);sumY[j]+=(isHorizontal()?p.width:p.height);if(elements[i][j]){elements[i][j].animate({x:p.x,y:p.y,width:p.width,height:p.height},duration);}else{elements[i].push(drawBar(p.x,p.y,p.width,p.height,colors[i],{x:p.xTick,y:p.yTick,label:self.labels[i]}));}});});}else if(util.isObject(series[0].data)){series.forEach(function(d,i){coordinate.use(coordinate.getAxisUse(i));var indexOfI=seriesArray.indexOf(i)
if(indexOfI==-1){return;}
var j=0,o;elements[i]=elements[i]||paper.set();for(o in d.data){sumY[j]=sumY[j]||0;var p=getPositions(o,d.data[o],indexOfI,seriesArray.length,sumY[j]);sumY[j]+=(isHorizontal()?p.width:p.height);if(elements[i][j]){elements[i][j].animate({x:p.x,y:p.y,width:p.width,height:p.height},duration);}else{elements[i].push(drawBar(p.x,p.y,p.width,p.height,colors[i],{x:p.xTick,y:p.yTick,label:self.labels[i]}));}
j++;}});}}
if(series.length){render();bindLegendEvents();coordinate.x.options.labelPosition="between_ticks";coordinate.y.on(function(){render(self.legend.activeArray);});}}});})();;;(function(undefined){var util=Venus.util;function getSectorPath(options){var opt=options||{},dir=opt.dir||1;var rad=Math.PI/180,angleOffset=opt.endAngle-opt.startAngle,x1,y1,xm,ym,x2,y2,path,xmr,ymr;x1=opt.x+opt.r*Math.cos(dir*opt.startAngle*rad);y1=opt.y+opt.r*Math.sin(dir*opt.startAngle*rad);xm=opt.x+opt.r/2*Math.cos(dir*(opt.startAngle+angleOffset/2)*rad);xmr=opt.x+opt.r*Math.cos(dir*(opt.startAngle+angleOffset/2)*rad);ym=opt.y+opt.r/2*Math.sin(dir*(opt.startAngle+angleOffset/2)*rad);ymr=opt.y+opt.r*Math.sin(dir*(opt.startAngle+angleOffset/2)*rad);x2=opt.x+opt.r*Math.cos(dir*opt.endAngle*rad);y2=opt.y+opt.r*Math.sin(dir*opt.endAngle*rad);if(parseInt(opt.hollow,10)>0){var xh1,yh1,xh2,yh2;xh1=opt.x+opt.hollow*Math.cos(dir*opt.startAngle*rad);yh1=opt.y+opt.hollow*Math.sin(dir*opt.startAngle*rad);xm=opt.x+(opt.hollow+opt.r/2-opt.hollow/2)*Math.cos(dir*(opt.startAngle+angleOffset/2)*rad);ym=opt.y+(opt.hollow+opt.r/2-opt.hollow/2)*Math.sin(dir*(opt.startAngle+angleOffset/2)*rad);xh2=opt.x+opt.hollow*Math.cos(dir*opt.endAngle*rad);yh2=opt.y+opt.hollow*Math.sin(dir*opt.endAngle*rad);path=["M",xh2,yh2,"A",opt.hollow,opt.hollow,0,+(Math.abs(angleOffset)>180),+(dir*(opt.endAngle-opt.startAngle)<0),xh1,yh1,"L",x1,y1,"A",opt.r,opt.r,0,+(Math.abs(angleOffset)>180),+(dir*(opt.endAngle-opt.startAngle)>0),x2,y2,"z"];}else{path=["M",opt.x,opt.y,"L",x1,y1,"A",opt.r,opt.r,0,+(Math.abs(angleOffset)>180),+(dir*(opt.endAngle-opt.startAngle)>0),x2,y2,"z"];}
return{path:path,pos:{xstart:x1,ystart:y1,xmiddle:xm,xMiddleOnBound:xmr,ymiddle:ym,yMiddleOnBound:ymr,xend:x2,yend:y2}};}
function SectorChart(options){var sector,text,opt=options||{},angleOffset=opt.endAngle-opt.startAngle,sectorPath=getSectorPath(opt),strokeOpt=util.mix({'stroke-width':1,'stroke':'#dedede',"stroke-linejoin":"round",'fill':opt.color},opt.stroke),pos;if(!opt.animation){sector=Math.abs(angleOffset)===360?opt.paper.circle(opt.x,opt.y,opt.r):opt.paper.path(sectorPath.path.join(' '));}else{sector=opt.paper.path().attr({arc:[opt.x,opt.y,opt.r,opt.hollow,opt.startAngle,opt.startAngle,opt.dir]}).animate({arc:[opt.x,opt.y,opt.r,opt.hollow,opt.startAngle,opt.endAngle,opt.dir]},opt.time||100,opt.callback);}
opt.color&&sector.attr(strokeOpt);pos=sectorPath.pos;util.mix(sector,{cx:opt.x,cy:opt.y,mx:pos.xmiddle,mxr:pos.xMiddleOnBound,my:pos.ymiddle,myr:pos.yMiddleOnBound,_data:opt.d,_index:opt.index,text:text,startAngle:opt.startAngle});return sector;}
function textPosition(pos){}
textPosition.rows={left:{},right:{}}
function initTexts(s,percents,opt,paper){var rows={0:[],1:[],2:[],3:[]},lineHeight=16,maxRow=Math.ceil(opt.r/lineHeight)-1,cx=opt.x,cy=opt.y,self=this,sectors=s.slice(0),startSwitch;function getArea(x,y){if(x>cx&&y<cy){return 0;}else if(x>cx&&y>cy){return 1;}else if(x<cx&&y>cy){return 2;}else{return 3;}}
function getPos(area,row){var l=lineHeight*(row+0.5);if(area==0||area==3){return cy-l;}else{return cy+l;}}
sectors.forEach(function(sector,i){var mxr=sector.mxr,myr=sector.myr,area=getArea(mxr,myr),row=Math.floor(Math.abs(myr-cy)/lineHeight);if(rows[area][row]!==undefined){if(area==0||area==2){rows[area].splice(row,0,i);}else{if(area==3&&row==maxRow&&mxr>cx-.1*opt.r){if(startSwitch===undefined){if(sectors.length-i<=rows[3].length-maxRow){startSwitch=i;}else{startSwitch=Math.ceil(sectors.length-i-(rows[3].length-maxRow))/2+i;}}
if(i>=startSwitch){rows[0][maxRow+sectors.length-i]=i;return;}}
for(var index=row+1;;index++){if(rows[area][index]===undefined){rows[area][index]=i;break;}}}}else{rows[area][row]=i;}});for(var area in rows){rows[area].forEach(function(index,i){if(index!==undefined){var sector=sectors[index],originIndex=sector._index,label=self.labels[originIndex],percent=percents[originIndex]+"%",span=30,text=paper.text(sector.mxr,getPos(area,i),label).attr({'font-size':13,'font-weight':'bolder'}),percentText=paper.text(sector.mxr,getPos(area,i)," "+percent).attr({'font-size':13});var width=text.getBBox().width,percentWidth=percentText.getBBox().width+10;text.attr({'x':sector.mxr+(area>1?-(span+percentWidth+width/2):+(span+width/2))});percentText.attr({'x':sector.mxr+(area>1?-(span+percentWidth/2):(span+width+percentWidth/2))});paper.path().attr({path:['M',sector.mxr,sector.myr,'S',sector.mxr,getPos(area,i),sector.mxr+(area>1?-span:span),getPos(area,i)],"stroke-width":1,"stroke":"#000000"});}});}}
Venus.SvgChart.addChart('pie',{draw:function(opt){var chartWidth=this.options.width,chartHeight=this.options.height,self=this,options=util.mix({x:chartWidth/2,y:chartHeight/2,radius:Math.min(chartWidth,chartHeight)/2.5,duration:900,animation:true,showText:true,rotate:-90,dir:1,hollow:0,stroke:{}},opt);if(options.hollow>=options.radius){options.hollow=0;}
options.r=options.radius;delete options.radius;var series=this.series.getSeries().slice(0).sort(function(a,b){return b.data-a.data}),colors=this.colors,paper=this.stage,data,total=0,elements=[],percents=[],startAngle=options.rotate*options.dir,endAngle,opts=[],t=0;paper.customAttributes.arc=function(x,y,r,hollow,startAngle,endAngle,dir){return{path:getSectorPath({x:x,y:y,r:r,hollow:hollow,startAngle:startAngle,endAngle:endAngle,dir:dir}).path};};series.forEach(function(s){total+=s.data;});series.forEach(function(s,i){data=s.data;percents.push((data/total*100).toFixed(2));endAngle=s.data/total*360+startAngle;opts.push({startAngle:startAngle,endAngle:endAngle,color:colors[i],d:options.showText&&data,time:Math.round(data/total*options.duration),index:i});startAngle=endAngle;});opts.forEach(function(item,i){if(options.animation){switch(options.animation){case'simultaneous':t=0;item.time=Math.max(Math.round(options.duration/opts.length),400);break;default:i>0?t+=opts[i-1].time:t=0;break;}}
setTimeout(function(){elements.push(SectorChart(util.mix({paper:paper,callback:function(){this.text&&this.text.show();}},util.mix(options,item))));if(i==opts.length-1&&options.showText){initTexts.call(self,elements,percents,options,paper);}},t);});function bindElementsAction(){elements&&elements.forEach(function(item){item.hover(function(){this.stop();this.transform('s1.1,1.1,'+this.cx+','+this.cy);},function(){this.animate({transform:'s1,1,'+this.cx+','+this.cy},500,"bounce");});});}
function bindLegendsAction(){if(!this.legend){return false;}
this.legend.itemSet.forEach(function(item,i){var el=elements[i];item.hover(function(){this.rotate(45);el.stop();el.transform('t'+(el.mx-el.cx)/5+','+(el.my-el.cy)/5);if(el.text){el.text.stop();el.text.transform('t'+(el.mx-el.cx)/5+','+(el.my-el.cy)/5);}},function(){this.rotate(-45);el.animate({transform:'s1,1,'+el.cx+','+el.cy},500,"bounce");if(el.text){el.text.animate({transform:'t0,0'},500,"bounce");}});});this.legend.on('click',(function(){var arr=new Array(series.length);return function(e,i){if(arr[i]==true||arr[i]==undefined){arr[i]=false;elements[i].attr('opacity',0).text.attr('opacity',0);}else{arr[i]=true;elements[i].attr('opacity',1).text.attr('opacity',1);}}})());}
(function(context){setTimeout(function(){bindElementsAction.call(context);bindLegendsAction.call(context);},t);})(this);}});})();;(function(){var util=Venus.util;function DotChart(paper,x,y,r,color,d){var dot;x=Math.random()*(x+y)/2+x/2;dot=paper.circle(x,y,r);color&&dot.attr({'stroke':'#fff','fill':color});return dot;}
Venus.SvgChart.addChart('dot',{draw:function(){var series=this.series.getSeries(),colors=this.colors,coordinate=this.coordinate,xAxis=coordinate.x,yAxis=coordinate.y,axisLength=Math.min(xAxis.model.totalWidth,yAxis.model.totalWidth),data,xy,posX,posY,radius,total=0,elements=[],paper=this.stage;for(var i=0,L=series.length;i<L;i++){if(util.isArray(series[i].data)){series[i].data.forEach(function(item){total+=item;});}else if(util.isObject(series[i].data)){for(var key in series[i].data){total+=series[i].data[key];}}else if(util.isNumber(series[i].data)){total+=series[i].data;}}
total*=2;for(var i=0,L=series.length;i<L;i++){elements.push([]);if(util.isArray(series[i].data)){series[i].data.forEach(function(item,j){data=item;xy=coordinate.get(j,item)
posX=xy.x;posY=xy.y;radius=data/total*axisLength;elements[i].push(DotChart(paper,posX,posY,radius,colors[i],data));});}else if(util.isObject(series[i].data)){var j=0;for(var key in series[i].data){data=series[i].data[key];xy=coordinate.get(key,data);posX=xy.x;posY=xy.y;radius=data/total*axisLength;elements[i].push(DotChart(paper,posX,posY,radius,colors[i],data));j++;}}else if(util.isNumber(series[i].data)){data=series[i].data;xy=coordinate.get(i,data);posX=xy.x;posY=xy.y;radius=data/total*axisLength;elements[i].push(DotChart(paper,posX,posY,radius,colors[i],data));}}
if(this.legend){this.legend.on('click',(function(){var arr=new Array(series.length);return function(e,i){if(arr[i]==true||arr[i]==undefined){arr[i]=false;elements[i].forEach(function(item){item.attr('opacity',0);});}else{arr[i]=true;elements[i].forEach(function(item){item.attr('opacity',1);});}}})());}}});})();