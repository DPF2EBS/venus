if(!Array.prototype.forEach){Array.prototype.forEach=function(g,b){var d,c;if(this==null){throw new TypeError("this is null or not defined")}var f=Object(this);var a=f.length>>>0;if({}.toString.call(g)!="[object Function]"){throw new TypeError(g+" is not a function")}if(b){d=b}c=0;while(c<a){var e;if(c in f){e=f[c];g.call(d,e,c,f)}c++}}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){if(this==null){throw new TypeError()}var d=Object(this);var a=d.length>>>0;if(a===0){return -1}var e=0;if(arguments.length>0){e=Number(arguments[1]);if(e!=e){e=0}else{if(e!=0&&e!=Infinity&&e!=-Infinity){e=(e>0||-1)*Math.floor(Math.abs(e))}}}if(e>=a){return -1}var b=e>=0?e:Math.max(a-Math.abs(e),0);for(;b<a;b++){if(b in d&&d[b]===c){return b}}return -1}}if(!Object.keys){Object.keys=function(c){if(c!==Object(c)){throw new TypeError("Object.keys called on a non-object")}var a=[],b;for(b in c){if(Object.prototype.hasOwnProperty.call(c,b)){a.push(b)}}return a}}var Kinetic={};Kinetic.Filters={};Kinetic.Global={BUBBLE_WHITELIST:["mousedown","mousemove","mouseup","mouseover","mouseout","click","dblclick","touchstart","touchmove","touchend","tap","dbltap","dragstart","dragmove","dragend"],stages:[],idCounter:0,tempNodes:[],maxDragTimeInterval:20,drag:{moving:false,offset:{x:0,y:0},lastDrawTime:0},warn:function(a){if(console&&console.warn){console.warn("Kinetic warning: "+a)}},_pullNodes:function(b){var a=this.tempNodes;for(var d=0;d<a.length;d++){var c=a[d];if(c.getStage()!==undefined&&c.getStage()._id===b._id){b._addId(c);b._addName(c);this.tempNodes.splice(d,1);d-=1}}}};Kinetic.Type={_isElement:function(a){return !!(a&&a.nodeType==1)},_isFunction:function(a){return !!(a&&a.constructor&&a.call&&a.apply)},_isObject:function(a){return(!!a&&a.constructor==Object)},_isArray:function(a){return Object.prototype.toString.call(a)=="[object Array]"},_isNumber:function(a){return Object.prototype.toString.call(a)=="[object Number]"},_isString:function(a){return Object.prototype.toString.call(a)=="[object String]"},_hasMethods:function(c){var b=[];for(var a in c){if(this._isFunction(c[a])){b.push(a)}}return b.length>0},_getXY:function(a){if(this._isNumber(a)){return{x:a,y:a}}else{if(this._isArray(a)){if(a.length===1){var b=a[0];if(this._isNumber(b)){return{x:b,y:b}}else{if(this._isArray(b)){return{x:b[0],y:b[1]}}else{if(this._isObject(b)){return b}}}}else{if(a.length>=2){return{x:a[0],y:a[1]}}}}else{if(this._isObject(a)){return a}}}return{x:0,y:0}},_getSize:function(a){if(this._isNumber(a)){return{width:a,height:a}}else{if(this._isArray(a)){if(a.length===1){var b=a[0];if(this._isNumber(b)){return{width:b,height:b}}else{if(this._isArray(b)){if(b.length>=4){return{width:b[2],height:b[3]}}else{if(b.length>=2){return{width:b[0],height:b[1]}}}}else{if(this._isObject(b)){return b}}}}else{if(a.length>=4){return{width:a[2],height:a[3]}}else{if(a.length>=2){return{width:a[0],height:a[1]}}}}}else{if(this._isObject(a)){return a}}}return{width:0,height:0}},_getPoints:function(b){if(b===undefined){return[]}if(this._isObject(b[0])){return b}else{var a=[];for(var c=0;c<b.length;c+=2){a.push({x:b[c],y:b[c+1]})}return a}},_getImage:function(a,f){if(!a){f(null)}else{if(this._isElement(a)){f(a)}else{if(this._isString(a)){var e=new Image();e.onload=function(){f(e)};e.src=a}else{if(a.data){var b=document.createElement("canvas");b.width=a.width;b.height=a.height;var c=b.getContext("2d");c.putImageData(a,0,0);var d=b.toDataURL();var e=new Image();e.onload=function(){f(e)};e.src=d}else{f(null)}}}}}};Kinetic.Canvas=function(b,a){this.element=document.createElement("canvas");this.context=this.element.getContext("2d");this.element.width=b;this.element.height=a};Kinetic.Canvas.prototype={clear:function(){var a=this.getContext();var b=this.getElement();a.clearRect(0,0,b.width,b.height)},getElement:function(){return this.element},getContext:function(){return this.context},setWidth:function(a){this.element.width=a},setHeight:function(a){this.element.height=a},getWidth:function(){return this.element.width},getHeight:function(){return this.element.height},setSize:function(b,a){this.setWidth(b);this.setHeight(a)},strip:function(){var a=this.context;a.stroke=function(){};a.fill=function(){};a.fillRect=function(c,e,d,b){a.rect(c,e,d,b)};a.strokeRect=function(c,e,d,b){a.rect(c,e,d,b)};a.drawImage=function(){};a.fillText=function(){};a.strokeText=function(){}},toDataURL:function(b,c){try{return this.element.toDataURL(b,c)}catch(a){return this.element.toDataURL()}}};(function(){var a=false;Kinetic.Class=function(){};Kinetic.Class.extend=function(f){var e=this.prototype;a=true;var d=new this();a=false;for(var c in f){d[c]=typeof f[c]=="function"&&typeof e[c]=="function"?(function(g,h){return function(){var j=this._super;this._super=e[g];var i=h.apply(this,arguments);this._super=j;return i}})(c,f[c]):f[c]}function b(){if(!a&&this.init){this.init.apply(this,arguments)}}b.prototype=d;b.prototype.constructor=b;b.extend=arguments.callee;return b}})();Kinetic.Animation={animations:[],animIdCounter:0,animRunning:false,frame:{time:0,timeDiff:0,lastTime:0},_addAnimation:function(a){a.id=this.animIdCounter++;this.animations.push(a)},_removeAnimation:function(a){var d=a.id;var c=this.animations;for(var b=0;b<c.length;b++){if(c[b].id===d){this.animations.splice(b,1);return false}}},_runFrames:function(){var a={};for(var d=0;d<this.animations.length;d++){var c=this.animations[d];if(c.node&&c.node._id!==undefined){a[c.node._id]=c.node}if(c.func){c.func(this.frame)}}for(var b in a){a[b].draw()}},_updateFrameObject:function(){var a=new Date();var b=a.getTime();if(this.frame.lastTime===0){this.frame.lastTime=b}else{this.frame.timeDiff=b-this.frame.lastTime;this.frame.lastTime=b;this.frame.time+=this.frame.timeDiff}},_animationLoop:function(){if(this.animations.length>0){this._updateFrameObject();this._runFrames();var a=this;requestAnimFrame(function(){a._animationLoop()})}else{this.animRunning=false;this.frame.lastTime=0}},_handleAnimation:function(){var a=this;if(!this.animRunning){this.animRunning=true;a._animationLoop()}else{this.frame.lastTime=0}}};requestAnimFrame=(function(a){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1000/60)}})();Kinetic.Node=Kinetic.Class.extend({init:function(a){this.defaultNodeAttrs={visible:true,listening:true,name:undefined,alpha:1,x:0,y:0,scale:{x:1,y:1},rotation:0,offset:{x:0,y:0},dragConstraint:"none",dragBounds:{},draggable:false};this.setDefaultAttrs(this.defaultNodeAttrs);this.eventListeners={};this.setAttrs(a);this.on("draggableChange.kinetic",function(){this._onDraggableChange()});var b=this;this.on("idChange.kinetic",function(c){var d=b.getStage();if(d){d._removeId(c.oldVal);d._addId(b)}});this.on("nameChange.kinetic",function(c){var d=b.getStage();if(d){d._removeName(c.oldVal,b._id);d._addName(b)}});this._onDraggableChange()},on:function(c,i){var g=c.split(" ");for(var d=0;d<g.length;d++){var h=g[d];var b=h;var f=b.split(".");var e=f[0];var a=f.length>1?f[1]:"";if(!this.eventListeners[e]){this.eventListeners[e]=[]}this.eventListeners[e].push({name:a,handler:i})}},off:function(b){var h=b.split(" ");for(var d=0;d<h.length;d++){var j=h[d];var a=j;var f=a.split(".");var e=f[0];if(this.eventListeners[e]&&f.length>1){var c=f[1];for(var g=0;g<this.eventListeners[e].length;g++){if(this.eventListeners[e][g].name===c){this.eventListeners[e].splice(g,1);if(this.eventListeners[e].length===0){delete this.eventListeners[e];break}g--}}}else{delete this.eventListeners[e]}}},getAttrs:function(){return this.attrs},setDefaultAttrs:function(a){if(this.attrs===undefined){this.attrs={}}if(a){for(var b in a){if(this.attrs[b]===undefined){this.attrs[b]=a[b]}}}},setAttrs:function(a){var c=Kinetic.Type;var d=this;if(a!==undefined){function b(h,l,k){for(var g in l){var i=l[g];var e=h[g];if(k===0){d._fireBeforeChangeEvent(g,e,i)}if(h[g]===undefined&&i!==undefined){h[g]={}}if(c._isObject(i)&&!c._isArray(i)&&!c._isElement(i)&&!c._hasMethods(i)){if(!Kinetic.Type._isObject(h[g])){h[g]={}}b(h[g],i,k+1)}else{switch(g){case"rotationDeg":d._setAttr(h,"rotation",l[g]*Math.PI/180);g="rotation";break;case"offset":var j=c._getXY(i);d._setAttr(h[g],"x",j.x);d._setAttr(h[g],"y",j.y);break;case"scale":var j=c._getXY(i);d._setAttr(h[g],"x",j.x);d._setAttr(h[g],"y",j.y);break;case"points":d._setAttr(h,g,c._getPoints(i));break;case"crop":var j=c._getXY(i);var f=c._getSize(i);d._setAttr(h[g],"x",j.x);d._setAttr(h[g],"y",j.y);d._setAttr(h[g],"width",f.width);d._setAttr(h[g],"height",f.height);break;default:d._setAttr(h,g,i);break}}if(k===0){d._fireChangeEvent(g,e,i)}}}b(this.attrs,a,0)}},isVisible:function(){if(this.attrs.visible&&this.getParent()&&!this.getParent().isVisible()){return false}return this.attrs.visible},show:function(){this.setAttrs({visible:true})},hide:function(){this.setAttrs({visible:false})},getZIndex:function(){return this.index},getAbsoluteZIndex:function(){var e=this.getLevel();var c=this.getStage();var d=this;var b=0;function a(g){var f=[];for(var i=0;i<g.length;i++){var h=g[i];b++;if(h.nodeType!=="Shape"){f=f.concat(h.getChildren())}if(h._id===d._id){i=g.length}}if(f.length>0&&f[0].getLevel()<=e){a(f)}}if(d.nodeType!=="Stage"){a(d.getStage().getChildren())}return b},getLevel:function(){var b=0;var a=this.parent;while(a){b++;a=a.parent}return b},setPosition:function(){var a=Kinetic.Type._getXY(Array.prototype.slice.call(arguments));this.setAttrs(a)},getPosition:function(){return{x:this.attrs.x,y:this.attrs.y}},getAbsolutePosition:function(){var a=this.getAbsoluteTransform();var b=this.getOffset();a.translate(b.x,b.y);return a.getTranslation()},setAbsolutePosition:function(){var c=Kinetic.Type._getXY(Array.prototype.slice.call(arguments));var a=this._clearTransform();this.attrs.x=a.x;this.attrs.y=a.y;delete a.x;delete a.y;var b=this.getAbsoluteTransform();b.invert();b.translate(c.x,c.y);c={x:this.attrs.x+b.getTranslation().x,y:this.attrs.y+b.getTranslation().y};this.setPosition(c.x,c.y);this._setTransform(a)},move:function(){var c=Kinetic.Type._getXY(Array.prototype.slice.call(arguments));var a=this.getX();var b=this.getY();if(c.x!==undefined){a+=c.x}if(c.y!==undefined){b+=c.y}this.setAttrs({x:a,y:b})},getRotationDeg:function(){return this.attrs.rotation*180/Math.PI},rotate:function(a){this.setAttrs({rotation:this.getRotation()+a})},rotateDeg:function(a){this.setAttrs({rotation:this.getRotation()+(a*Math.PI/180)})},moveToTop:function(){var a=this.index;this.parent.children.splice(a,1);this.parent.children.push(this);this.parent._setChildrenIndices()},moveUp:function(){var a=this.index;this.parent.children.splice(a,1);this.parent.children.splice(a+1,0,this);this.parent._setChildrenIndices()},moveDown:function(){var a=this.index;if(a>0){this.parent.children.splice(a,1);this.parent.children.splice(a-1,0,this);this.parent._setChildrenIndices()}},moveToBottom:function(){var a=this.index;this.parent.children.splice(a,1);this.parent.children.unshift(this);this.parent._setChildrenIndices()},setZIndex:function(b){var a=this.index;this.parent.children.splice(a,1);this.parent.children.splice(b,0,this);this.parent._setChildrenIndices()},getAbsoluteAlpha:function(){var b=1;var a=this;while(a.nodeType!=="Stage"){b*=a.attrs.alpha;a=a.parent}return b},isDragging:function(){var a=Kinetic.Global;return a.drag.node!==undefined&&a.drag.node._id===this._id&&a.drag.moving},moveTo:function(b){var a=this.parent;a.children.splice(this.index,1);a._setChildrenIndices();b.children.push(this);this.index=b.children.length-1;this.parent=b;b._setChildrenIndices()},getParent:function(){return this.parent},getLayer:function(){if(this.nodeType==="Layer"){return this}else{return this.getParent().getLayer()}},getStage:function(){if(this.nodeType!=="Stage"&&this.getParent()){return this.getParent().getStage()}else{if(this.nodeType==="Stage"){return this}else{return undefined}}},simulate:function(a){this._handleEvent(a,{})},transitionTo:function(c){var b=Kinetic.Animation;if(this.transAnim){b._removeAnimation(this.transAnim);this.transAnim=null}var f=this.nodeType==="Stage"?this:this.getLayer();var e=this;var d=new Kinetic.Transition(this,c);var g={func:function(){d._onEnterFrame()},node:f};this.transAnim=g;b._addAnimation(g);d.onFinished=function(){b._removeAnimation(g);e.transAnim=null;if(c.callback!==undefined){c.callback()}g.node.draw()};d.start();b._handleAnimation();return d},getAbsoluteTransform:function(){var e=new Kinetic.Transform();var c=[];var b=this.parent;c.unshift(this);while(b){c.unshift(b);b=b.parent}for(var f=0;f<c.length;f++){var d=c[f];var a=d.getTransform();e.multiply(a)}return e},getTransform:function(){var a=new Kinetic.Transform();if(this.attrs.x!==0||this.attrs.y!==0){a.translate(this.attrs.x,this.attrs.y)}if(this.attrs.rotation!==0){a.rotate(this.attrs.rotation)}if(this.attrs.scale.x!==1||this.attrs.scale.y!==1){a.scale(this.attrs.scale.x,this.attrs.scale.y)}if(this.attrs.offset&&(this.attrs.offset.x!==0||this.attrs.offset.y!==0)){a.translate(-1*this.attrs.offset.x,-1*this.attrs.offset.y)}return a},clone:function(f){var e=this.shapeType||this.nodeType;var c=new Kinetic[e](this.attrs);for(var b in this.eventListeners){var a=this.eventListeners[b];for(var g=0;g<a.length;g++){var d=a[g];if(d.name.indexOf("kinetic")<0){if(!c.eventListeners[b]){c.eventListeners[b]=[]}c.eventListeners[b].push(d)}}}c.setAttrs(f);return c},saveImageData:function(f,a){try{var c;if(f&&a){c=new Kinetic.Canvas(f,a)}else{var b=this.getStage();c=b.bufferCanvas}var d=c.getContext();c.clear();this._draw(c);var h=d.getImageData(0,0,c.getWidth(),c.getHeight());this.imageData=h}catch(g){Kinetic.Global.warn("Image data could not saved because canvas is dirty.")}},clearImageData:function(){delete this.imageData},getImageData:function(){return this.imageData},toDataURL:function(b){var d=b&&b.mimeType?b.mimeType:null;var e=b&&b.quality?b.quality:null;var a;if(b&&b.width&&b.height){a=new Kinetic.Canvas(b.width,b.height)}else{a=this.getStage().bufferCanvas}var c=a.getContext();a.clear();this._draw(a);return a.toDataURL(d,e)},toImage:function(a){Kinetic.Type._getImage(this.toDataURL(a),function(b){a.callback(b)})},_clearTransform:function(){var a={x:this.attrs.x,y:this.attrs.y,rotation:this.attrs.rotation,scale:{x:this.attrs.scale.x,y:this.attrs.scale.y},offset:{x:this.attrs.offset.x,y:this.attrs.offset.y}};this.attrs.x=0;this.attrs.y=0;this.attrs.rotation=0;this.attrs.scale={x:1,y:1};this.attrs.offset={x:0,y:0};return a},_setTransform:function(b){for(var a in b){this.attrs[a]=b[a]}},_setImageData:function(a){if(a&&a.data){this.imageData=a}},_fireBeforeChangeEvent:function(a,b,c){this._handleEvent("before"+a.toUpperCase()+"Change",{oldVal:b,newVal:c})},_fireChangeEvent:function(a,b,c){this._handleEvent(a+"Change",{oldVal:b,newVal:c})},_setAttr:function(b,a,c){if(c!==undefined){if(b===undefined){b={}}b[a]=c}},_listenDrag:function(){this._dragCleanup();var b=Kinetic.Global;var a=this;this.on("mousedown.kinetic touchstart.kinetic",function(c){a._initDrag()})},_initDrag:function(){var d=Kinetic.Global;var b=this.getStage();var f=b.getUserPosition();if(f){var a=this.getTransform().getTranslation();var e=this.getAbsoluteTransform().getTranslation();var c=this.getAbsolutePosition();d.drag.node=this;d.drag.offset.x=f.x-c.x;d.drag.offset.y=f.y-c.y}},_onDraggableChange:function(){if(this.attrs.draggable){this._listenDrag()}else{this._dragCleanup();var a=this.getStage();var b=Kinetic.Global;if(a&&b.drag.node&&b.drag.node._id===this._id){a._endDrag()}}},_dragCleanup:function(){this.off("mousedown.kinetic");this.off("touchstart.kinetic")},_handleEvent:function(a,g){if(this.nodeType==="Shape"){g.shape=this}var e=this.getStage();var b=e?e.mouseoverShape:null;var h=e?e.mouseoutShape:null;var c=this.eventListeners;var f=true;if(a==="mouseover"&&h&&h._id===this._id){f=false}else{if(a==="mouseout"&&b&&b._id===this._id){f=false}}if(f){if(c[a]){var j=c[a];for(var d=0;d<j.length;d++){j[d].handler.apply(this,[g])}}if(e&&b&&h){e.mouseoverShape=b.parent;e.mouseoutShape=h.parent}if(Kinetic.Global.BUBBLE_WHITELIST.indexOf(a)>=0&&!g.cancelBubble&&this.parent){this._handleEvent.call(this.parent,a,g)}}}});Kinetic.Node.addSetters=function(c,b){for(var d=0;d<b.length;d++){var a=b[d];this._addSetter(c,a)}};Kinetic.Node.addGetters=function(c,b){for(var d=0;d<b.length;d++){var a=b[d];this._addGetter(c,a)}};Kinetic.Node.addGettersSetters=function(b,a){this.addSetters(b,a);this.addGetters(b,a)};Kinetic.Node._addSetter=function(b,a){var c=this;var d="set"+a.charAt(0).toUpperCase()+a.slice(1);b.prototype[d]=function(){if(arguments.length==1){arg=arguments[0]}else{arg=Array.prototype.slice.call(arguments)}var e={};e[a]=arg;this.setAttrs(e)}};Kinetic.Node._addGetter=function(b,a){var c=this;var d="get"+a.charAt(0).toUpperCase()+a.slice(1);b.prototype[d]=function(e){return this.attrs[a]}};Kinetic.Node.addGettersSetters(Kinetic.Node,["x","y","scale","detectionType","rotation","alpha","name","id","offset","draggable","dragConstraint","dragBounds","listening"]);Kinetic.Node.addSetters(Kinetic.Node,["rotationDeg"]);Kinetic.Container=Kinetic.Node.extend({init:function(a){this.children=[];this._super(a)},getChildren:function(){return this.children},removeChildren:function(){while(this.children.length>0){this.remove(this.children[0])}},add:function(c){c._id=Kinetic.Global.idCounter++;c.index=this.children.length;c.parent=this;this.children.push(c);var a=c.getStage();if(a===undefined){var b=Kinetic.Global;b.tempNodes.push(c)}else{a._addId(c);a._addName(c);var b=Kinetic.Global;b._pullNodes(a)}if(this._add!==undefined){this._add(c)}return this},remove:function(e){if(e&&e.index!==undefined&&this.children[e.index]._id==e._id){var a=this.getStage();if(a!==undefined){a._removeId(e.getId());a._removeName(e.getName(),e._id)}var c=Kinetic.Global;for(var d=0;d<c.tempNodes.length;d++){var b=c.tempNodes[d];if(b._id===e._id){c.tempNodes.splice(d,1);break}}this.children.splice(e.index,1);this._setChildrenIndices();while(e.children&&e.children.length>0){e.remove(e.children[0])}if(this._remove!==undefined){this._remove(e)}}return this},get:function(b){var c=this.getStage();var a;var d=b.slice(1);if(b.charAt(0)==="#"){a=c.ids[d]!==undefined?[c.ids[d]]:[]}else{if(b.charAt(0)==="."){a=c.names[d]!==undefined?c.names[d]:[]}else{if(b==="Shape"||b==="Group"||b==="Layer"){return this._getNodes(b)}else{return false}}}var g=[];for(var f=0;f<a.length;f++){var e=a[f];if(this.isAncestorOf(e)){g.push(e)}}return g},isAncestorOf:function(b){if(this.nodeType==="Stage"){return true}var a=b.getParent();while(a){if(a._id===this._id){return true}a=a.getParent()}return false},getIntersections:function(){var e=Kinetic.Type._getXY(Array.prototype.slice.call(arguments));var a=[];var b=this.get("Shape");for(var d=0;d<b.length;d++){var c=b[d];if(c.isVisible()&&c.intersects(e)){a.push(c)}}return a},_getNodes:function(c){var a=[];function b(d){var e=d.getChildren();for(var g=0;g<e.length;g++){var f=e[g];if(f.nodeType===c){a.push(f)}else{if(f.nodeType!=="Shape"){b(f)}}}}b(this);return a},_drawChildren:function(b){var a=this.getStage();var c=this.children;for(var e=0;e<c.length;e++){var d=c[e];if(d.nodeType==="Shape"){if(d.isVisible()&&a.isVisible()){d._draw(b)}}else{d.draw(b)}}},_setChildrenIndices:function(){for(var a=0;a<this.children.length;a++){this.children[a].index=a}}});Kinetic.Stage=Kinetic.Container.extend({init:function(a){this.setDefaultAttrs({width:400,height:200,throttle:80});if(typeof a.container==="string"){a.container=document.getElementById(a.container)}this._super(a);this._setStageDefaultProperties();this._id=Kinetic.Global.idCounter++;this._buildDOM();this._bindContentEvents();this.on("widthChange.kinetic",function(){this._resizeDOM()});this.on("heightChange.kinetic",function(){this._resizeDOM()});var b=Kinetic.Global;b.stages.push(this);this._addId(this);this._addName(this)},onFrame:function(a){this.anim={func:a}},start:function(){if(!this.animRunning){var b=Kinetic.Animation;b._addAnimation(this.anim);b._handleAnimation();this.animRunning=true}},stop:function(){Kinetic.Animation._removeAnimation(this.anim);this.animRunning=false},draw:function(a){this._draw(a)},setSize:function(){var a=Kinetic.Type._getSize(Array.prototype.slice.call(arguments));this.setAttrs(a)},getSize:function(){return{width:this.attrs.width,height:this.attrs.height}},clear:function(){var a=this.children;for(var b=0;b<a.length;b++){a[b].clear()}},toJSON:function(){var a=Kinetic.Type;function b(e){var f={};f.attrs={};for(var d in e.attrs){var g=e.attrs[d];if(!a._isFunction(g)&&!a._isElement(g)&&!a._hasMethods(g)){f.attrs[d]=g}}f.nodeType=e.nodeType;f.shapeType=e.shapeType;if(e.nodeType!=="Shape"){f.children=[];var c=e.getChildren();for(var i=0;i<c.length;i++){var h=c[i];f.children.push(b(h))}}return f}return JSON.stringify(b(this))},reset:function(){this.removeChildren();this._setStageDefaultProperties();this.setAttrs(this.defaultNodeAttrs)},load:function(a){this.reset();function c(f,g){var d=g.children;if(d!==undefined){for(var j=0;j<d.length;j++){var i=d[j];var e;if(i.nodeType==="Shape"){if(i.shapeType===undefined){e="Shape"}else{e=i.shapeType}}else{e=i.nodeType}var h=new Kinetic[e](i.attrs);f.add(h);c(h,i)}}}var b=JSON.parse(a);this.attrs=b.attrs;c(this,b);this.draw()},getMousePosition:function(a){return this.mousePos},getTouchPosition:function(a){return this.touchPos},getUserPosition:function(a){return this.getTouchPosition()||this.getMousePosition()},getContainer:function(){return this.attrs.container},getStage:function(){return this},getDOM:function(){return this.content},toDataURL:function(e){var a=e&&e.mimeType?e.mimeType:null;var h=e&&e.quality?e.quality:null;var b=e&&e.width?e.width:this.attrs.width;var i=e&&e.height?e.height:this.attrs.height;var d=new Kinetic.Canvas(b,i);var c=d.getContext();var g=this.children;function f(m){var k=g[m];var j=k.getCanvas().toDataURL(a,h);var l=new Image();l.onload=function(){c.drawImage(l,0,0);if(m<g.length-1){f(m+1)}else{e.callback(d.toDataURL(a,h))}};l.src=j}f(0)},toImage:function(a){this.toDataURL({callback:function(b){Kinetic.Type._getImage(b,function(c){a.callback(c)})}})},_resizeDOM:function(){var c=this.attrs.width;var a=this.attrs.height;this.content.style.width=c+"px";this.content.style.height=a+"px";this.bufferCanvas.setSize(c,a);this.pathCanvas.setSize(c,a);var d=this.children;for(var e=0;e<d.length;e++){var b=d[e];b.getCanvas().setSize(c,a);b.draw()}},_remove:function(a){try{this.content.removeChild(a.canvas)}catch(b){}},_add:function(a){a.canvas.setSize(this.attrs.width,this.attrs.height);a.draw();this.content.appendChild(a.canvas.element);a.lastDrawTime=0},_detectEvent:function(b,a){var d=Kinetic.Global.drag.moving;var f=Kinetic.Global;var g=this.getUserPosition();var c=b.eventListeners;var e=this;if(this.targetShape&&b._id===this.targetShape._id){this.targetFound=true}if(b.isVisible()&&g!==undefined&&b.intersects(g)){if(!d&&this.mouseDown){this.mouseDown=false;this.clickStart=true;b._handleEvent("mousedown",a);return true}else{if(this.mouseUp){this.mouseUp=false;b._handleEvent("mouseup",a);if(this.clickStart){if((!f.drag.moving)||!f.drag.node){b._handleEvent("click",a);if(this.inDoubleClickWindow){b._handleEvent("dblclick",a)}this.inDoubleClickWindow=true;setTimeout(function(){e.inDoubleClickWindow=false},this.dblClickWindow)}}return true}else{if(!d&&this.touchStart&&!this.touchMove){this.touchStart=false;this.tapStart=true;b._handleEvent("touchstart",a);return true}else{if(this.touchEnd){this.touchEnd=false;b._handleEvent("touchend",a);if(this.tapStart){if((!f.drag.moving)||!f.drag.node){b._handleEvent("tap",a);if(this.inDoubleClickWindow){b._handleEvent("dbltap",a)}this.inDoubleClickWindow=true;setTimeout(function(){e.inDoubleClickWindow=false},this.dblClickWindow)}}return true}else{if(!d&&this.touchMove){b._handleEvent("touchmove",a);return true}else{if(!d&&this._isNewTarget(b,a)){if(this.mouseoutShape){this.mouseoverShape=b;this.mouseoutShape._handleEvent("mouseout",a);this.mouseoverShape=undefined}b._handleEvent("mouseover",a);this._setTarget(b);return true}else{if(!d&&this.mouseMove){b._handleEvent("mousemove",a);return true}}}}}}}}else{if(!d&&this.targetShape&&this.targetShape._id===b._id){this._setTarget(undefined);this.mouseoutShape=b;return true}}return false},_setTarget:function(a){this.targetShape=a;this.targetFound=true},_isNewTarget:function(b,a){if(!this.targetShape||(!this.targetFound&&b._id!==this.targetShape._id)){if(this.targetShape){var c=this.targetShape.eventListeners;if(c){this.mouseoutShape=this.targetShape}}return true}else{return false}},_traverseChildren:function(e,a){var d=e.children;for(var c=d.length-1;c>=0;c--){var f=d[c];if(f.getListening()){if(f.nodeType==="Shape"){var b=this._detectEvent(f,a);if(b){return true}}else{var b=this._traverseChildren(f,a);if(b){return true}}}}return false},_handleStageEvent:function(b){var c=new Date();var f=c.getTime();this.lastEventTime=f;var e=Kinetic.Global;if(!b){b=window.event}this._setMousePosition(b);this._setTouchPosition(b);this.pathCanvas.clear();this.targetFound=false;var a=false;for(var g=this.children.length-1;g>=0;g--){var d=this.children[g];if(d.isVisible()&&g>=0&&d.getListening()){if(this._traverseChildren(d,b)){a=true;break}}}if(!a&&this.mouseoutShape){this.mouseoutShape._handleEvent("mouseout",b);this.mouseoutShape=undefined}},_bindContentEvents:function(){var d=Kinetic.Global;var c=this;var a=["mousedown","mousemove","mouseup","mouseover","mouseout","touchstart","touchmove","touchend"];for(var e=0;e<a.length;e++){var b=a[e];(function(){var f=b;c.content.addEventListener(f,function(g){c["_"+f](g)},false)}())}},_mouseover:function(a){this._handleStageEvent(a)},_mouseout:function(b){var a=this.targetShape;if(a){a._handleEvent("mouseout",b);this.targetShape=undefined}this.mousePos=undefined;this._endDrag(b)},_mousemove:function(a){var d=this.attrs.throttle;var b=new Date();var e=b.getTime();var f=e-this.lastEventTime;var c=1000/d;if(f>=c||d>200){this.mouseDown=false;this.mouseUp=false;this.mouseMove=true;this._handleStageEvent(a)}this._startDrag(a)},_mousedown:function(a){this.mouseDown=true;this.mouseUp=false;this.mouseMove=false;this._handleStageEvent(a);if(this.attrs.draggable){this._initDrag()}},_mouseup:function(a){this.mouseDown=false;this.mouseUp=true;this.mouseMove=false;this._handleStageEvent(a);this.clickStart=false;this._endDrag(a)},_touchstart:function(a){a.preventDefault();this.touchStart=true;this.touchEnd=false;this.touchMove=false;this._handleStageEvent(a);if(this.attrs.draggable){this._initDrag()}},_touchend:function(a){this.touchStart=false;this.touchEnd=true;this.touchMove=false;this._handleStageEvent(a);this.tapStart=false;this._endDrag(a)},_touchmove:function(a){var d=this;var e=this.attrs.throttle;var b=new Date();var f=b.getTime();var g=f-this.lastEventTime;var c=1000/e;if(g>=c||e>200){a.preventDefault();d.touchEnd=false;d.touchMove=true;d._handleStageEvent(a)}this._startDrag(a)},_setMousePosition:function(a){var c=a.offsetX||(a.clientX-this._getContentPosition().left+window.pageXOffset);var b=a.offsetY||(a.clientY-this._getContentPosition().top+window.pageYOffset);this.mousePos={x:c,y:b}},_setTouchPosition:function(c){if(c.touches!==undefined&&c.touches.length===1){var d=c.touches[0];var b=d.clientX-this._getContentPosition().left+window.pageXOffset;var a=d.clientY-this._getContentPosition().top+window.pageYOffset;this.touchPos={x:b,y:a}}},_getContentPosition:function(){var b=this.content.getBoundingClientRect(),a=document.documentElement;return{top:b.top+a.scrollTop,left:b.left+a.scrollLeft}},_endDrag:function(a){var b=Kinetic.Global;if(b.drag.node){if(b.drag.moving){b.drag.moving=false;b.drag.node._handleEvent("dragend",a)}}b.drag.node=undefined},_startDrag:function(g){var d=this;var b=Kinetic.Global;var a=b.drag.node;if(a){var f=d.getUserPosition();var h=a.attrs.dragConstraint;var i=a.attrs.dragBounds;var c={x:a.attrs.x,y:a.attrs.y};var e={x:f.x-b.drag.offset.x,y:f.y-b.drag.offset.y};if(i.left!==undefined&&e.x<i.left){e.x=i.left}if(i.right!==undefined&&e.x>i.right){e.x=i.right}if(i.top!==undefined&&e.y<i.top){e.y=i.top}if(i.bottom!==undefined&&e.y>i.bottom){e.y=i.bottom}a.setAbsolutePosition(e);if(h==="horizontal"){a.attrs.y=c.y}else{if(h==="vertical"){a.attrs.x=c.x}}if(b.drag.node.nodeType==="Stage"){b.drag.node.draw()}else{b.drag.node.getLayer().draw()}if(!b.drag.moving){b.drag.moving=true;b.drag.node._handleEvent("dragstart",g)}b.drag.node._handleEvent("dragmove",g)}},_buildDOM:function(){this.content=document.createElement("div");this.content.style.position="relative";this.content.style.display="inline-block";this.content.className="kineticjs-content";this.attrs.container.appendChild(this.content);this.bufferCanvas=new Kinetic.Canvas({width:this.attrs.width,height:this.attrs.height});this.pathCanvas=new Kinetic.Canvas({width:this.attrs.width,height:this.attrs.height});this.pathCanvas.strip();this._resizeDOM()},_addId:function(a){if(a.attrs.id!==undefined){this.ids[a.attrs.id]=a}},_removeId:function(a){if(a!==undefined){delete this.ids[a]}},_addName:function(b){var a=b.attrs.name;if(a!==undefined){if(this.names[a]===undefined){this.names[a]=[]}this.names[a].push(b)}},_removeName:function(b,c){if(b!==undefined){var a=this.names[b];if(a!==undefined){for(var e=0;e<a.length;e++){var d=a[e];if(d._id===c){a.splice(e,1)}}if(a.length===0){delete this.names[b]}}}},_onContent:function(b,d){var c=b.split(" ");for(var e=0;e<c.length;e++){var a=c[e];this.content.addEventListener(a,d,false)}},_setStageDefaultProperties:function(){this.nodeType="Stage";this.lastEventTime=0;this.dblClickWindow=400;this.targetShape=undefined;this.targetFound=false;this.mouseoverShape=undefined;this.mouseoutShape=undefined;this.mousePos=undefined;this.mouseDown=false;this.mouseUp=false;this.mouseMove=false;this.clickStart=false;this.touchPos=undefined;this.touchStart=false;this.touchEnd=false;this.touchMove=false;this.tapStart=false;this.ids={};this.names={};this.anim=undefined;this.animRunning=false},_draw:function(a){this._drawChildren(a)}});Kinetic.Node.addGettersSetters(Kinetic.Stage,["width","height","throttle"]);Kinetic.Layer=Kinetic.Container.extend({init:function(a){this.setDefaultAttrs({throttle:80,clearBeforeDraw:true});this.nodeType="Layer";this.lastDrawTime=0;this.beforeDrawFunc=undefined;this.afterDrawFunc=undefined;this.canvas=new Kinetic.Canvas();this.canvas.getElement().style.position="absolute";this._super(a)},draw:function(b){var e=this.attrs.throttle;var a=new Date();var f=a.getTime();var g=f-this.lastDrawTime;var c=1000/e;if(g>=c||e>200){this._draw(b);if(this.drawTimeout!==undefined){clearTimeout(this.drawTimeout);this.drawTimeout=undefined}}else{if(this.drawTimeout===undefined){var d=this;this.drawTimeout=setTimeout(function(){d.draw(b)},17)}}},beforeDraw:function(a){this.beforeDrawFunc=a},afterDraw:function(a){this.afterDrawFunc=a},getCanvas:function(){return this.canvas},getContext:function(){return this.canvas.context},clear:function(){this.getCanvas().clear()},toDataURL:function(b){var a;var c=b&&b.mimeType?b.mimeType:null;var d=b&&b.quality?b.quality:null;if(b&&b.width&&b.height){a=new Kinetic.Canvas(b.width,b.height)}else{a=this.getCanvas()}return a.toDataURL(c,d)},_draw:function(b){if(!b){b=this.getCanvas()}var a=new Date();var c=a.getTime();this.lastDrawTime=c;if(this.beforeDrawFunc!==undefined){this.beforeDrawFunc.call(this)}if(this.attrs.clearBeforeDraw){b.clear()}if(this.isVisible()){if(this.attrs.drawFunc!==undefined){this.attrs.drawFunc.call(this)}this._drawChildren(b)}if(this.afterDrawFunc!==undefined){this.afterDrawFunc.call(this)}}});Kinetic.Node.addGettersSetters(Kinetic.Layer,["clearBeforeDraw","throttle"]);Kinetic.Group=Kinetic.Container.extend({init:function(a){this.nodeType="Group";this._super(a)},draw:function(a){this._draw(a)},_draw:function(a){if(this.attrs.visible){this._drawChildren(a)}}});Kinetic.Shape=Kinetic.Node.extend({init:function(a){this.setDefaultAttrs({detectionType:"path"});this.nodeType="Shape";this.appliedShadow=false;this._super(a)},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},stroke:function(a){var c=Kinetic.Global;var b=false;if(this.attrs.stroke||this.attrs.strokeWidth){a.save();if(this.attrs.shadow&&!this.appliedShadow){b=this._applyShadow(a)}var d=this.attrs.stroke?this.attrs.stroke:"black";var e=this.attrs.strokeWidth?this.attrs.strokeWidth:2;a.lineWidth=e;a.strokeStyle=d;a.stroke(a);a.restore()}if(b){this.stroke(a)}},fill:function(b){var j=false;var k=this.attrs.fill;if(k){b.save();if(this.attrs.shadow&&!this.appliedShadow){j=this._applyShadow(b)}var l=k.start;var i=k.end;var h=null;if(typeof k=="string"){h=this.attrs.fill;b.fillStyle=h;b.fill(b)}else{if(k.image){var a=!k.repeat?"repeat":k.repeat;h=b.createPattern(k.image,a);b.save();if(k.scale){b.scale(k.scale.x,k.scale.y)}if(k.offset){b.translate(k.offset.x,k.offset.y)}b.fillStyle=h;b.fill(b);b.restore()}else{if(!l.radius&&!i.radius){var g=b.createLinearGradient(l.x,l.y,i.x,i.y);var c=k.colorStops;for(var d=0;d<c.length;d+=2){g.addColorStop(c[d],c[d+1])}h=g;b.fillStyle=h;b.fill(b)}else{if((l.radius||l.radius===0)&&(i.radius||i.radius===0)){var g=b.createRadialGradient(l.x,l.y,l.radius,i.x,i.y,i.radius);var c=k.colorStops;for(var d=0;d<c.length;d+=2){g.addColorStop(c[d],c[d+1])}h=g;b.fillStyle=h;b.fill(b)}else{h="black";b.fillStyle=h;b.fill(b)}}}}b.restore()}if(j){this.fill(b)}},fillText:function(a,c){var b=false;if(this.attrs.textFill){a.save();if(this.attrs.shadow&&!this.appliedShadow){b=this._applyShadow(a)}a.fillStyle=this.attrs.textFill;a.fillText(c,0,0);a.restore()}if(b){this.fillText(contex,c,0,0)}},strokeText:function(a,e){var c=false;if(this.attrs.textStroke||this.attrs.textStrokeWidth){a.save();if(this.attrs.shadow&&!this.appliedShadow){c=this._applyShadow(a)}var b=this.attrs.textStroke?this.attrs.textStroke:"black";var d=this.attrs.textStrokeWidth?this.attrs.textStrokeWidth:2;a.lineWidth=d;a.strokeStyle=b;a.strokeText(e,0,0);a.restore()}if(c){this.strokeText(a,e,0,0)}},drawImage:function(){var d=false;var c=arguments[0];c.save();var b=Array.prototype.slice.call(arguments);if(b.length===6||b.length===10){if(this.attrs.shadow&&!this.appliedShadow){d=this._applyShadow(c)}if(b.length===6){c.drawImage(b[1],b[2],b[3],b[4],b[5])}else{c.drawImage(b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9])}}c.restore();if(d){this.drawImage.apply(this,b)}},applyLineJoin:function(a){if(this.attrs.lineJoin){a.lineJoin=this.attrs.lineJoin}},_applyShadow:function(b){var c=this.attrs.shadow;if(c){var d=this.getAbsoluteAlpha();var a=c.color?c.color:"black";var f=c.blur?c.blur:5;var e=c.offset?c.offset:{x:0,y:0};if(c.alpha){b.globalAlpha=c.alpha*d}b.shadowColor=a;b.shadowBlur=f;b.shadowOffsetX=e.x;b.shadowOffsetY=e.y;this.appliedShadow=true;return true}return false},intersects:function(){var f=Kinetic.Type._getXY(Array.prototype.slice.call(arguments));var c=this.getStage();if(this.attrs.detectionType==="path"){var b=c.pathCanvas;var d=b.getContext();this._draw(b);return d.isPointInPath(f.x,f.y)}if(this.imageData){var a=c.attrs.width;var e=this.imageData.data[((a*f.y)+f.x)*4+3];return(e)}return false},_draw:function(c){if(this.attrs.drawFunc){var h=this.getStage();var b=c.getContext();var g=[];var i=this.parent;g.unshift(this);while(i){g.unshift(i);i=i.parent}b.save();for(var d=0;d<g.length;d++){var f=g[d];var j=f.getTransform();var e=j.getMatrix();b.transform(e[0],e[1],e[2],e[3],e[4],e[5])}var a=this.getAbsoluteAlpha();if(a!==1){b.globalAlpha=a}this.applyLineJoin(b);this.appliedShadow=false;this.attrs.drawFunc.call(this,c.getContext());b.restore()}}});Kinetic.Node.addGettersSetters(Kinetic.Shape,["fill","stroke","lineJoin","strokeWidth","shadow","drawFunc","filter"]);Kinetic.Rect=Kinetic.Shape.extend({init:function(a){this.setDefaultAttrs({width:0,height:0,cornerRadius:0});this.shapeType="Rect";a.drawFunc=function(b){b.beginPath();if(this.attrs.cornerRadius===0){b.rect(0,0,this.attrs.width,this.attrs.height)}else{b.moveTo(this.attrs.cornerRadius,0);b.lineTo(this.attrs.width-this.attrs.cornerRadius,0);b.arc(this.attrs.width-this.attrs.cornerRadius,this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI*3/2,0,false);b.lineTo(this.attrs.width,this.attrs.height-this.attrs.cornerRadius);b.arc(this.attrs.width-this.attrs.cornerRadius,this.attrs.height-this.attrs.cornerRadius,this.attrs.cornerRadius,0,Math.PI/2,false);b.lineTo(this.attrs.cornerRadius,this.attrs.height);b.arc(this.attrs.cornerRadius,this.attrs.height-this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI/2,Math.PI,false);b.lineTo(0,this.attrs.cornerRadius);b.arc(this.attrs.cornerRadius,this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI,Math.PI*3/2,false)}b.closePath();this.fill(b);this.stroke(b)};this._super(a)},setSize:function(){var a=Kinetic.Type._getSize(Array.prototype.slice.call(arguments));this.setAttrs(a)},getSize:function(){return{width:this.attrs.width,height:this.attrs.height}}});Kinetic.Node.addGettersSetters(Kinetic.Rect,["width","height","cornerRadius"]);Kinetic.Ellipse=Kinetic.Shape.extend({init:function(a){this.setDefaultAttrs({radius:{x:0,y:0}});this.shapeType="Ellipse";a.drawFunc=function(c){var d=this.getRadius();c.beginPath();c.save();if(d.x!==d.y){c.scale(1,d.y/d.x)}c.arc(0,0,d.x,0,Math.PI*2,true);c.restore();c.closePath();this.fill(c);this.stroke(c)};this._super(a);this._convertRadius();var b=this;this.on("radiusChange.kinetic",function(){b._convertRadius()})},_convertRadius:function(){var b=Kinetic.Type;var a=this.getRadius();if(b._isObject(a)){return false}this.attrs.radius=b._getXY(a)}});Kinetic.Circle=Kinetic.Ellipse;Kinetic.Node.addGettersSetters(Kinetic.Ellipse,["radius"]);Kinetic.Image=Kinetic.Shape.extend({init:function(a){this.shapeType="Image";a.drawFunc=function(d){if(!!this.attrs.image){var f=this.getWidth();var b=this.getHeight();d.beginPath();d.rect(0,0,f,b);d.closePath();this.fill(d);this.stroke(d);if(this.attrs.crop&&this.attrs.crop.width&&this.attrs.crop.height){var h=this.attrs.crop.x?this.attrs.crop.x:0;var g=this.attrs.crop.y?this.attrs.crop.y:0;var e=this.attrs.crop.width;var c=this.attrs.crop.height;this.drawImage(d,this.attrs.image,h,g,e,c,0,0,f,b)}else{this.drawImage(d,this.attrs.image,0,0,f,b)}}};this._super(a)},setSize:function(){var a=Kinetic.Type._getSize(Array.prototype.slice.call(arguments));this.setAttrs(a)},getSize:function(){return{width:this.attrs.width,height:this.attrs.height}},getWidth:function(){if(this.attrs.width){return this.attrs.width}if(this.attrs.image){return this.attrs.image.width}return 0},getHeight:function(){if(this.attrs.height){return this.attrs.height}if(this.attrs.image){return this.attrs.image.height}return 0},applyFilter:function(a){try{var b=this._clearTransform();this.saveImageData(this.getWidth(),this.getHeight());this._setTransform(b);a.filter.call(this,a);var c=this;Kinetic.Type._getImage(this.getImageData(),function(e){c.setImage(e);if(a.callback){a.callback()}})}catch(d){Kinetic.Global.warn("Unable to apply filter.")}}});Kinetic.Node.addGettersSetters(Kinetic.Image,["image","crop","filter"]);Kinetic.Node.addSetters(Kinetic.Image,["width","height"]);Kinetic.Sprite=Kinetic.Shape.extend({init:function(a){this.setDefaultAttrs({index:0,frameRate:17});a.drawFunc=function(d){if(!!this.attrs.image){var g=this.attrs.animation;var c=this.attrs.index;var e=this.attrs.animations[g][c];d.beginPath();d.rect(0,0,e.width,e.height);d.closePath();this.drawImage(d,this.attrs.image,e.x,e.y,e.width,e.height,0,0,e.width,e.height)}};this._super(a);var b=this;this.on("animationChange.kinetic",function(){b.setIndex(0)})},start:function(){var c=this;var a=this.getLayer();var b=Kinetic.Animation;if(this.anim){b._removeAnimation(this.anim);this.anim=null}this.anim={node:a};b._addAnimation(this.anim);this.interval=setInterval(function(){var d=c.attrs.index;c._updateIndex();if(c.afterFrameFunc&&d===c.afterFrameIndex){c.afterFrameFunc()}},1000/this.attrs.frameRate);b._handleAnimation()},stop:function(){var a=Kinetic.Animation;if(this.anim){a._removeAnimation(this.anim);this.anim=null}clearInterval(this.interval)},afterFrame:function(a,b){this.afterFrameIndex=a;this.afterFrameFunc=b},_updateIndex:function(){var c=this.attrs.index;var b=this.attrs.animation;if(c<this.attrs.animations[b].length-1){this.attrs.index++}else{this.attrs.index=0}}});Kinetic.Node.addGettersSetters(Kinetic.Sprite,["animation","animations","index"]);Kinetic.Polygon=Kinetic.Shape.extend({init:function(a){this.setDefaultAttrs({points:[]});this.shapeType="Polygon";a.drawFunc=function(b){b.beginPath();b.moveTo(this.attrs.points[0].x,this.attrs.points[0].y);for(var c=1;c<this.attrs.points.length;c++){b.lineTo(this.attrs.points[c].x,this.attrs.points[c].y)}b.closePath();this.fill(b);this.stroke(b)};this._super(a)}});Kinetic.Node.addGettersSetters(Kinetic.Polygon,["points"]);Kinetic.RegularPolygon=Kinetic.Shape.extend({init:function(a){this.setDefaultAttrs({radius:0,sides:0});this.shapeType="RegularPolygon";a.drawFunc=function(c){c.beginPath();c.moveTo(0,0-this.attrs.radius);for(var e=1;e<this.attrs.sides;e++){var b=this.attrs.radius*Math.sin(e*2*Math.PI/this.attrs.sides);var d=-1*this.attrs.radius*Math.cos(e*2*Math.PI/this.attrs.sides);c.lineTo(b,d)}c.closePath();this.fill(c);this.stroke(c)};this._super(a)}});Kinetic.Node.addGettersSetters(Kinetic.RegularPolygon,["radius","sides"]);Kinetic.Star=Kinetic.Shape.extend({init:function(a){this.setDefaultAttrs({numPoints:0,innerRadius:0,outerRadius:0});this.shapeType="Star";a.drawFunc=function(d){d.beginPath();d.moveTo(0,0-this.attrs.outerRadius);for(var f=1;f<this.attrs.numPoints*2;f++){var c=f%2===0?this.attrs.outerRadius:this.attrs.innerRadius;var b=c*Math.sin(f*Math.PI/this.attrs.numPoints);var e=-1*c*Math.cos(f*Math.PI/this.attrs.numPoints);d.lineTo(b,e)}d.closePath();this.fill(d);this.stroke(d)};this._super(a)}});Kinetic.Node.addGettersSetters(Kinetic.Star,["numPoints","innerRadius","outerRadius"]);Kinetic.Text=Kinetic.Shape.extend({init:function(c){this.setDefaultAttrs({fontFamily:"Calibri",text:"",fontSize:12,align:"left",verticalAlign:"top",fontStyle:"normal",padding:0,width:"auto",height:"auto",detectionType:"path",cornerRadius:0,lineHeight:1.2});this.dummyCanvas=document.createElement("canvas");this.shapeType="Text";c.drawFunc=function(g){g.beginPath();var i=this.getBoxWidth();var l=this.getBoxHeight();if(this.attrs.cornerRadius===0){g.rect(0,0,i,l)}else{g.moveTo(this.attrs.cornerRadius,0);g.lineTo(i-this.attrs.cornerRadius,0);g.arc(i-this.attrs.cornerRadius,this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI*3/2,0,false);g.lineTo(i,l-this.attrs.cornerRadius);g.arc(i-this.attrs.cornerRadius,l-this.attrs.cornerRadius,this.attrs.cornerRadius,0,Math.PI/2,false);g.lineTo(this.attrs.cornerRadius,l);g.arc(this.attrs.cornerRadius,l-this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI/2,Math.PI,false);g.lineTo(0,this.attrs.cornerRadius);g.arc(this.attrs.cornerRadius,this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI,Math.PI*3/2,false)}g.closePath();this.fill(g);this.stroke(g);var j=this.attrs.padding;var h=this.attrs.lineHeight*this.getTextHeight();var f=this.textArr;g.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"pt "+this.attrs.fontFamily;g.textBaseline="middle";g.textAlign="left";g.save();g.translate(j,0);g.translate(0,j+this.getTextHeight()/2);for(var m=0;m<f.length;m++){var k=f[m];g.save();if(this.attrs.align==="right"){g.translate(this.getBoxWidth()-this._getTextSize(k).width-j*2,0)}else{if(this.attrs.align==="center"){g.translate((this.getBoxWidth()-this._getTextSize(k).width-j*2)/2,0)}}this.fillText(g,k);this.strokeText(g,k);g.restore();g.translate(0,h)}g.restore()};this._super(c);var b=["width","height","padding","text","textStroke","textStrokeWidth"];var d=this;for(var e=0;e<b.length;e++){var a=b[e];this.on(a+"Change.kinetic",d._setTextData)}d._setTextData()},getBoxWidth:function(){return this.attrs.width==="auto"?this.getTextWidth()+this.attrs.padding*2:this.attrs.width},getBoxHeight:function(){return this.attrs.height==="auto"?(this.getTextHeight()*this.textArr.length*this.attrs.lineHeight)+this.attrs.padding*2:this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(d){var c=this.dummyCanvas;var a=c.getContext("2d");a.save();a.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"pt "+this.attrs.fontFamily;var b=a.measureText(d);a.restore();return{width:b.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var j=this.attrs.text.split("");var d=[];var i=0;var g=true;this.textWidth=0;this.textHeight=this._getTextSize(this.attrs.text).height;var b=this.attrs.lineHeight*this.textHeight;while(j.length>0&&g&&(this.attrs.height==="auto"||b*(i+1)<this.attrs.height-this.attrs.padding*2)){var f=0;var k=undefined;g=false;while(f<j.length){if(j.indexOf("\n")===f){j.splice(f,1);k=j.splice(0,f).join("");break}var e=j.slice(0,f);if(this.attrs.width!=="auto"&&this._getTextSize(e.join("")).width>this.attrs.width-this.attrs.padding*2){if(f==0){break}var h=e.lastIndexOf(" ");var c=e.lastIndexOf("-");var a=Math.max(h,c);if(a>=0){k=j.splice(0,1+a).join("");break}k=j.splice(0,f).join("");break}f++;if(f===j.length){k=j.splice(0,f).join("")}}this.textWidth=Math.max(this.textWidth,this._getTextSize(k).width);if(k!==undefined){d.push(k);g=true}i++}this.textArr=d}});Kinetic.Node.addGettersSetters(Kinetic.Text,["fontFamily","fontSize","fontStyle","textFill","textStroke","textStrokeWidth","padding","align","lineHeight","text","width","height","cornerRadius","fill","stroke","strokeWidth","shadow"]);Kinetic.Line=Kinetic.Shape.extend({init:function(a){this.setDefaultAttrs({points:[],lineCap:"butt",dashArray:[],detectionType:"pixel"});this.shapeType="Line";a.drawFunc=function(c){var f={};c.beginPath();c.moveTo(this.attrs.points[0].x,this.attrs.points[0].y);for(var h=1;h<this.attrs.points.length;h++){var b=this.attrs.points[h].x;var g=this.attrs.points[h].y;if(this.attrs.dashArray.length>0){var e=this.attrs.points[h-1].x;var d=this.attrs.points[h-1].y;this._dashedLine(c,e,d,b,g,this.attrs.dashArray)}else{c.lineTo(b,g)}}if(!!this.attrs.lineCap){c.lineCap=this.attrs.lineCap}this.stroke(c)};this._super(a)},_dashedLine:function(c,n,k,a,l,i){var h=i.length;var p=(a-n),o=(l-k);var d=p>o;var j=(d)?o/p:p/o;if(j>9999){j=9999}else{if(j<-9999){j=-9999}}var f=Math.sqrt(p*p+o*o);var g=0,m=true;while(f>=0.1&&g<10000){var b=i[g++%h];if(b===0){b=0.001}if(b>f){b=f}var e=Math.sqrt(b*b/(1+j*j));if(d){n+=p<0&&o<0?e*-1:e;k+=p<0&&o<0?j*e*-1:j*e}else{n+=p<0&&o<0?j*e*-1:j*e;k+=p<0&&o<0?e*-1:e}c[m?"lineTo":"moveTo"](n,k);f-=b;m=!m}c.moveTo(a,l)}});Kinetic.Node.addGettersSetters(Kinetic.Line,["dashArray","lineCap","points"]);Kinetic.Path=Kinetic.Shape.extend({init:function(a){this.shapeType="Path";this.dataArray=[];var b=this;a.drawFunc=function(h){var l=this.dataArray;h.beginPath();for(var j=0;j<l.length;j++){var s=l[j].command;var f=l[j].points;switch(s){case"L":h.lineTo(f[0],f[1]);break;case"M":h.moveTo(f[0],f[1]);break;case"C":h.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case"Q":h.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case"A":var m=f[0],k=f[1],g=f[2],e=f[3],i=f[4],q=f[5],t=f[6],o=f[7];var d=(g>e)?g:e;var v=(g>e)?1:g/e;var u=(g>e)?e/g:1;h.translate(m,k);h.rotate(t);h.scale(v,u);h.arc(0,0,d,i,i+q,1-o);h.scale(1/v,1/u);h.rotate(-t);h.translate(-m,-k);break;case"z":h.closePath();break}}this.fill(h);this.stroke(h)};this._super(a);this.dataArray=this._getDataArray();this.on("dataChange",function(){b.dataArray=b._getDataArray()})},_getDataArray:function(){var e=this.attrs.data;if(!this.attrs.data){return[]}var k=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var q=0;q<k.length;q++){e=e.replace(new RegExp(k[q],"g"),"|"+k[q])}var a=e.split("|");var m=[];var j=0;var h=0;for(var q=1;q<a.length;q++){var r=a[q];var y=r.charAt(0);r=r.slice(1);r=r.replace(new RegExp(",-","g"),"-");r=r.replace(new RegExp("-","g"),",-");var l=r.split(",");if(l.length>0&&l[0]===""){l.shift()}for(var v=0;v<l.length;v++){l[v]=parseFloat(l[v])}while(l.length>0){if(isNaN(l[0])){break}var t=undefined;var u=[];switch(y){case"l":j+=l.shift();h+=l.shift();t="L";u.push(j,h);break;case"L":j=l.shift();h=l.shift();u.push(j,h);break;case"m":j+=l.shift();h+=l.shift();t="M";u.push(j,h);y="l";break;case"M":j=l.shift();h=l.shift();t="M";u.push(j,h);y="L";break;case"h":j+=l.shift();t="L";u.push(j,h);break;case"H":j=l.shift();t="L";u.push(j,h);break;case"v":h+=l.shift();t="L";u.push(j,h);break;case"V":h=l.shift();t="L";u.push(j,h);break;case"C":u.push(l.shift(),l.shift(),l.shift(),l.shift());j=l.shift();h=l.shift();u.push(j,h);break;case"c":u.push(j+l.shift(),h+l.shift(),j+l.shift(),h+l.shift());j+=l.shift();h+=l.shift();t="C";u.push(j,h);break;case"S":var A=j,z=h;var s=m[m.length-1];if(s.command==="C"){A=j+(j-s.points[2]);z=h+(h-s.points[3])}u.push(A,z,l.shift(),l.shift());j=l.shift();h=l.shift();t="C";u.push(j,h);break;case"s":var A=j,z=h;var s=m[m.length-1];if(s.command==="C"){A=j+(j-s.points[2]);z=h+(h-s.points[3])}u.push(A,z,j+l.shift(),h+l.shift());j+=l.shift();h+=l.shift();t="C";u.push(j,h);break;case"Q":u.push(l.shift(),l.shift());j=l.shift();h=l.shift();u.push(j,h);break;case"q":u.push(j+l.shift(),h+l.shift());j+=l.shift();h+=l.shift();t="Q";u.push(j,h);break;case"T":var A=j,z=h;var s=m[m.length-1];if(s.command==="Q"){A=j+(j-s.points[0]);z=h+(h-s.points[1])}j=l.shift();h=l.shift();t="Q";u.push(A,z,j,h);break;case"t":var A=j,z=h;var s=m[m.length-1];if(s.command==="Q"){A=j+(j-s.points[0]);z=h+(h-s.points[1])}j+=l.shift();h+=l.shift();t="Q";u.push(A,z,j,h);break;case"A":var f=l.shift(),d=l.shift(),x=l.shift(),o=l.shift(),g=l.shift();var w=j,b=h;j=l.shift(),h=l.shift();t="A";u=this._convertEndpointToCenterParameterization(w,b,j,h,o,g,f,d,x);break;case"a":var f=l.shift(),d=l.shift(),x=l.shift(),o=l.shift(),g=l.shift();var w=j,b=h;j+=l.shift(),h+=l.shift();t="A";u=this._convertEndpointToCenterParameterization(w,b,j,h,o,g,f,d,x);break}m.push({command:t||y,points:u})}if(y==="z"||y==="Z"){m.push({command:"z",points:[]})}}return m},_convertEndpointToCenterParameterization:function(w,d,t,c,s,k,j,i,g){var A=g*(Math.PI/180);var m=Math.cos(A)*(w-t)/2+Math.sin(A)*(d-c)/2;var x=-1*Math.sin(A)*(w-t)/2+Math.cos(A)*(d-c)/2;var p=(m*m)/(j*j)+(x*x)/(i*i);if(p>1){j*=Math.sqrt(p);i*=Math.sqrt(p)}var z=Math.sqrt((((j*j)*(i*i))-((j*j)*(x*x))-((i*i)*(m*m)))/((j*j)*(x*x)+(i*i)*(m*m)));if(s==k){z*=-1}if(isNaN(z)){z=0}var h=z*j*x/i;var q=z*-i*m/j;var e=(w+t)/2+Math.cos(A)*h-Math.sin(A)*q;var b=(d+c)/2+Math.sin(A)*h+Math.cos(A)*q;var B=function(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])};var a=function(C,f){return(C[0]*f[0]+C[1]*f[1])/(B(C)*B(f))};var r=function(C,f){return(C[0]*f[1]<C[1]*f[0]?-1:1)*Math.acos(a(C,f))};var l=r([1,0],[(m-h)/j,(x-q)/i]);var o=[(m-h)/j,(x-q)/i];var n=[(-1*m-h)/j,(-1*x-q)/i];var y=r(o,n);if(a(o,n)<=-1){y=Math.PI}if(a(o,n)>=1){y=0}if(k==0&&y>0){y=y-2*Math.PI}if(k==1&&y<0){y=y+2*Math.PI}return[e,b,j,i,l,y,A,k]}});Kinetic.Node.addGettersSetters(Kinetic.Path,["data"]);Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]};Kinetic.Transform.prototype={translate:function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b;this.m[5]+=this.m[1]*a+this.m[3]*b},scale:function(b,a){this.m[0]*=b;this.m[1]*=b;this.m[2]*=a;this.m[3]*=a},rotate:function(a){var h=Math.cos(a);var b=Math.sin(a);var e=this.m[0]*h+this.m[2]*b;var d=this.m[1]*h+this.m[3]*b;var g=this.m[0]*-b+this.m[2]*h;var f=this.m[1]*-b+this.m[3]*h;this.m[0]=e;this.m[1]=d;this.m[2]=g;this.m[3]=f},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},multiply:function(c){var e=this.m[0]*c.m[0]+this.m[2]*c.m[1];var d=this.m[1]*c.m[0]+this.m[3]*c.m[1];var g=this.m[0]*c.m[2]+this.m[2]*c.m[3];var f=this.m[1]*c.m[2]+this.m[3]*c.m[3];var b=this.m[0]*c.m[4]+this.m[2]*c.m[5]+this.m[4];var a=this.m[1]*c.m[4]+this.m[3]*c.m[5]+this.m[5];this.m[0]=e;this.m[1]=d;this.m[2]=g;this.m[3]=f;this.m[4]=b;this.m[5]=a},invert:function(){var g=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]);var f=this.m[3]*g;var e=-this.m[1]*g;var c=-this.m[2]*g;var b=this.m[0]*g;var a=g*(this.m[2]*this.m[5]-this.m[3]*this.m[4]);var h=g*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=f;this.m[1]=e;this.m[2]=c;this.m[3]=b;this.m[4]=a;this.m[5]=h},getMatrix:function(){return this.m}};Kinetic.Transition=function(e,a){this.node=e;this.config=a;this.tweens=[];var d=this;function c(m,i,l,k){for(var j in m){if(j!=="duration"&&j!=="easing"&&j!=="callback"){if(Kinetic.Type._isObject(m[j])){l[j]={};c(m[j],i[j],l[j],k)}else{d._add(d._getTween(i,j,m[j],l,k))}}}}var g={};c(a,e.attrs,g,g);var f=0;for(var h=0;h<this.tweens.length;h++){var b=this.tweens[h];b.onFinished=function(){f++;if(f>=d.tweens.length){d.onFinished()}}}};Kinetic.Transition.prototype={start:function(){for(var a=0;a<this.tweens.length;a++){this.tweens[a].start()}},stop:function(){for(var a=0;a<this.tweens.length;a++){this.tweens[a].stop()}},resume:function(){for(var a=0;a<this.tweens.length;a++){this.tweens[a].resume()}},_onEnterFrame:function(){for(var a=0;a<this.tweens.length;a++){this.tweens[a].onEnterFrame()}},_add:function(a){this.tweens.push(a)},_getTween:function(h,a,b,e,f){var c=this.config;var d=this.node;var g=c.easing;if(g===undefined){g="linear"}var i=new Kinetic.Tween(d,function(j){e[a]=j;d.setAttrs(f)},Kinetic.Tweens[g],h[a],b,c.duration);return i}};Kinetic.Tween=function(e,f,c,b,a,d){this._listeners=[];this.addListener(this);this.obj=e;this.propFunc=f;this.begin=b;this._pos=b;this.setDuration(d);this.isPlaying=false;this._change=0;this.prevTime=0;this.prevPos=0;this.looping=false;this._time=0;this._position=0;this._startTime=0;this._finish=0;this.name="";this.func=c;this.setFinish(a)};Kinetic.Tween.prototype={setTime:function(a){this.prevTime=this._time;if(a>this.getDuration()){if(this.looping){this.rewind(a-this._duration);this.update();this.broadcastMessage("onLooped",{target:this,type:"onLooped"})}else{this._time=this._duration;this.update();this.stop();this.broadcastMessage("onFinished",{target:this,type:"onFinished"})}}else{if(a<0){this.rewind();this.update()}else{this._time=a;this.update()}}},getTime:function(){return this._time},setDuration:function(a){this._duration=(a===null||a<=0)?100000:a},getDuration:function(){return this._duration},setPosition:function(a){this.prevPos=this._pos;this.propFunc(a);this._pos=a;this.broadcastMessage("onChanged",{target:this,type:"onChanged"})},getPosition:function(a){if(a===undefined){a=this._time}return this.func(a,this.begin,this._change,this._duration)},setFinish:function(a){this._change=a-this.begin},getFinish:function(){return this.begin+this._change},start:function(){this.rewind();this.startEnterFrame();this.broadcastMessage("onStarted",{target:this,type:"onStarted"})},rewind:function(a){this.stop();this._time=(a===undefined)?0:a;this.fixTime();this.update()},fforward:function(){this._time=this._duration;this.fixTime();this.update()},update:function(){this.setPosition(this.getPosition(this._time))},startEnterFrame:function(){this.stopEnterFrame();this.isPlaying=true;this.onEnterFrame()},onEnterFrame:function(){if(this.isPlaying){this.nextFrame()}},nextFrame:function(){this.setTime((this.getTimer()-this._startTime)/1000)},stop:function(){this.stopEnterFrame();this.broadcastMessage("onStopped",{target:this,type:"onStopped"})},stopEnterFrame:function(){this.isPlaying=false},continueTo:function(a,b){this.begin=this._pos;this.setFinish(a);if(this._duration!==undefined){this.setDuration(b)}this.start()},resume:function(){this.fixTime();this.startEnterFrame();this.broadcastMessage("onResumed",{target:this,type:"onResumed"})},yoyo:function(){this.continueTo(this.begin,this._time)},addListener:function(a){this.removeListener(a);return this._listeners.push(a)},removeListener:function(d){var b=this._listeners;var c=b.length;while(c--){if(b[c]==d){b.splice(c,1);return true}}return false},broadcastMessage:function(){var b=[];for(var f=0;f<arguments.length;f++){b.push(arguments[f])}var g=b.shift();var d=this._listeners;var c=d.length;for(var f=0;f<c;f++){if(d[f][g]){d[f][g].apply(d[f],b)}}},fixTime:function(){this._startTime=this.getTimer()-this._time*1000},getTimer:function(){return new Date().getTime()-this._time}};Kinetic.Tweens={"back-ease-in":function(g,e,k,j,f,i){var h=1.70158;return k*(g/=j)*g*((h+1)*g-h)+e},"back-ease-out":function(g,e,k,j,f,i){var h=1.70158;return k*((g=g/j-1)*g*((h+1)*g+h)+1)+e},"back-ease-in-out":function(g,e,k,j,f,i){var h=1.70158;if((g/=j/2)<1){return k/2*(g*g*(((h*=(1.525))+1)*g-h))+e}return k/2*((g-=2)*g*(((h*=(1.525))+1)*g+h)+2)+e},"elastic-ease-in":function(g,e,k,j,f,i){var h=0;if(g===0){return e}if((g/=j)==1){return e+k}if(!i){i=j*0.3}if(!f||f<Math.abs(k)){f=k;h=i/4}else{h=i/(2*Math.PI)*Math.asin(k/f)}return -(f*Math.pow(2,10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i))+e},"elastic-ease-out":function(g,e,k,j,f,i){var h=0;if(g===0){return e}if((g/=j)==1){return e+k}if(!i){i=j*0.3}if(!f||f<Math.abs(k)){f=k;h=i/4}else{h=i/(2*Math.PI)*Math.asin(k/f)}return(f*Math.pow(2,-10*g)*Math.sin((g*j-h)*(2*Math.PI)/i)+k+e)},"elastic-ease-in-out":function(g,e,k,j,f,i){var h=0;if(g===0){return e}if((g/=j/2)==2){return e+k}if(!i){i=j*(0.3*1.5)}if(!f||f<Math.abs(k)){f=k;h=i/4}else{h=i/(2*Math.PI)*Math.asin(k/f)}if(g<1){return -0.5*(f*Math.pow(2,10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i))+e}return f*Math.pow(2,-10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i)*0.5+k+e},"bounce-ease-out":function(e,a,g,f){if((e/=f)<(1/2.75)){return g*(7.5625*e*e)+a}else{if(e<(2/2.75)){return g*(7.5625*(e-=(1.5/2.75))*e+0.75)+a}else{if(e<(2.5/2.75)){return g*(7.5625*(e-=(2.25/2.75))*e+0.9375)+a}else{return g*(7.5625*(e-=(2.625/2.75))*e+0.984375)+a}}}},"bounce-ease-in":function(e,a,g,f){return g-Kinetic.Tweens["bounce-ease-out"](f-e,0,g,f)+a},"bounce-ease-in-out":function(e,a,g,f){if(e<f/2){return Kinetic.Tweens["bounce-ease-in"](e*2,0,g,f)*0.5+a}else{return Kinetic.Tweens["bounce-ease-out"](e*2-f,0,g,f)*0.5+g*0.5+a}},"ease-in":function(e,a,g,f){return g*(e/=f)*e+a},"ease-out":function(e,a,g,f){return -g*(e/=f)*(e-2)+a},"ease-in-out":function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e+a}return -g/2*((--e)*(e-2)-1)+a},"strong-ease-in":function(e,a,g,f){return g*(e/=f)*e*e*e*e+a},"strong-ease-out":function(e,a,g,f){return g*((e=e/f-1)*e*e*e*e+1)+a},"strong-ease-in-out":function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e*e*e*e+a}return g/2*((e-=2)*e*e*e*e+2)+a},linear:function(e,a,g,f){return g*e/f+a}};Kinetic.Filters.Grayscale=function(){var b=this.imageData.data;for(var a=0;a<b.length;a+=4){var c=0.34*b[a]+0.5*b[a+1]+0.16*b[a+2];b[a]=c;b[a+1]=c;b[a+2]=c}};this.Venus={_Venus:this.Venus};Venus.util={};Venus.config={version:1,debug:false};(function(){var a=Venus.util||{};var b=function(k,u,n){var g,l,e,d,o,r=[];g=Math.floor(k/60)%6;l=g%2?k/60-g:1-(k/60-g);e=n*(1-u);d=n*(1-l*u);switch(g){case 0:r=[n,d,e];break;case 1:r=[d,n,e];break;case 2:r=[e,n,d];break;case 3:r=[e,d,n];break;case 4:r=[d,e,n];break;case 5:r=[n,e,d];break}for(var i=0,m=r.length;i<m;i++){r[i]=Math.floor(r[i]*255)}return r};a.getColors=function(g){var i=[0.6,0.2,0.05,0.1333,0.75,0],h=[0.75,0.75,0.45,1,0.35],f=[0.75,0.45,0.9,0.6,0.9],e=[],d;g=parseInt(g,10)||10;d=Math.min(g,Math.max(g/h.length,12));for(var j=0;j<g;j++){if(j<i.length&&g<=i.length){e.push("rgba("+b(i[j]*360,h[0],f[0]).join(",")+", 1)")}else{e.push("rgba("+b(j%d*360/d,h[Math.floor(j/d)],f[Math.floor(j/d)]).join(",")+", 1)")}}return e};a.mix=function(f,e){for(var d in e){if(typeof e[d]!=="object"||f[d]===undefined||typeof f[d]!=="object"){f[d]=e[d]}else{a.mix(f[d],e[d])}}return f};a.isArray=function(d){return c(d,"array")};a.isObject=function(d){return c(d,"object")};a.isNumber=function(d){return c(d,"number")};a.isFunction=function(d){return c(d,"function")};function c(e,d){var f=Object.prototype.toString.call(e).slice(8,-1);f=f.toLowerCase();return !d?f:e!==undefined&&e!==null&&f===d}})();(function(){var a=Venus.util||{};var d=Array.prototype.slice;var b=function(){this.events={}};var c=function(g,f){return(g.events[f])||(g.events[f]={callbacks:[]})},e=function(h,f,g){c(h,f).callbacks.push(g)};b.prototype.on=function(f,g){if(typeof g!=="function"){return}e(this,f,g)};b.prototype.off=function(g,k){if(!k){this.events[g]={callbacks:[]}}else{var f,j=0,h=c(this,g).callbacks;while(f=h[j++]){if(f===k){h.splice(--j,1)}}}};b.prototype.one=function(g,h){if(typeof h!=="function"){return}var f=this;e(this,g,function(){h.apply(g,d.call(arguments,0));f.off(g,arguments.callee)})};b.prototype.fire=function(){var g=arguments[0],h=d.call(arguments,1),j,f=0;if(this.events[g]&&this.events[g].callbacks){while(j=this.events[g].callbacks[f++]){j.apply(g,h)}}return this};b.prototype.clear=function(){this.events={}};a.CustomEvent=b})();Kinetic.SimpleText=Kinetic.Shape.extend({init:function(a){this.setDefaultAttrs({text:"",font:"12",textAlign:"left",textBaseline:"top"});this.shapeType="SimpleText";a.drawFunc=function(b){var c=this.attrs.text;b.save();b.font=this.attrs.font,b.textAlign=this.attrs.textAlign;b.textBaseline=this.attrs.textBaseline;this.fillText(b,c);this.stroke(b,c);b.restore()};this._super(a)}});(function(b,c){var d=b.Venus,g=d.util;var n=g.mix,o=Math.PI,f={};function m(q,s,r){if(!q||!q.nodeType){return}var p={width:q.clientWidth,height:q.clientHeight,margin:10};this.container=q;this.data=s||[];this.events=new m.CustomEvent();this.options=n(p,r||{});this._initCanvas();this.fire("onCanvasInit",this.stage,this.layer);this._initData();this.fire("onDataInit",this.series);this._initAxis();this.fire("onAxisInit",{});this._initLegend();this.fire("onLegendInit",this.legend);this._initGrid();this.fire("onGridInit",this.grid);this.draw();this._initEvents();this.events.fire("onFinish")}n(m,g);m.prototype={constructor:m,_initCanvas:function(){this.stage=new Kinetic.Stage({container:this.container,width:this.options.width,height:this.options.height});this.layer=new Kinetic.Layer()},_initData:function(){this.series=new j(this.data)},_initAxis:function(){var t=this.options,w=t.axis,r={},u,s,q,p,v;if(typeof w=="undefined"){return}for(var u in w){if((s=w[u])){s.axisType=u;if(u=="y"&&(!s.ticks||s.ticks.length==0)){q=this.series.getRange();if(s.max===c){s.max=q.max}if(s.min===c){s.min=q.min}}if(u=="x"){if(!s.ticks){s.ticks=this.series.getLabels()}}s.canvasWidth=this.options.width;s.canvasHeight=this.options.height;s.margin=this.options.margin;r[u]=new h(this.options,s,this.series,this.layer)}}this.axises=r},_initLegend:function(){var p=this.options;if(p.legend){this.legend=new a(p,this.series,this.layer)}},_initGrid:function(){var p=this.options;if(p.grid){this.grid=new e(p,this.layer)}},_initEvents:function(){},draw:function(){for(var p in f){if(this.options[p]){f[p].draw&&f[p].draw.call(this)}}this.stage.add(this.layer);this.percentLayer&&this.stage.add(this.percentLayer)},update:function(){},fire:function(){this.events.fire.apply(this.events,arguments)},on:function(){this.events.on.apply(this.events,arguments)}};m.addChart=function(p,q){f[p]=q};var j=function(p){this.data=p;this.__prepareData()};j.prototype={constructor:j,__prepareData:function(){var r=this.series=[],q,s=this.data,p;if(m.isArray(s)){s.forEach(function(t){if(m.isArray(t)){r.push({name:t[0],data:t[1]})}else{if(m.isObject(t)){r.push({name:(typeof t.name==="undefined"?t.label:t.name),data:t.data})}else{r.push({data:t});this.__nolabel=true}}})}else{if(m.isObject(s)){Object.keys(s).forEach(function(t){r.push({name:t,data:s[t]})})}else{}}p=m.getColors(r.length);r.forEach(function(u,t){u.color=p[t]});q=r.map(function(t){return t.data});this._range={min:Math.min.apply(Math,q),max:Math.max.apply(Math,q)}},getRange:function(){return this._range},getSeries:function(){return this.series},getLabels:function(){if(!!this.__nolabel){return}else{return this.series.forEach(function(p){return p.name})}}};var h=function(v,z,u,w){var s={axisType:"x",max:0,min:0,tickSize:1,tickWidth:30,ticks:[]},x,p=[],q=this.options=n(s,z),t,r,y;if(q.axisType=="x"){q.beginX=q.margin;q.beginY=q.canvasHeight-q.margin;q.endX=q.canvasWidth-q.margin;q.endY=q.margin;q.length=q.canvasWidth-2*q.margin;q.scaleSize=q.length/(q.ticks[q.ticks.length-1]-q.ticks[0]);q.tickWidth=q.length/q.ticks.length}else{if(q.axisType=="y"){q.beginX=q.margin;q.beginY=q.canvasHeight-q.margin;q.endX=q.margin;q.endY=q.margin;q.length=q.canvasHeight-2*q.margin;q.scaleSize=q.length/(q.ticks[q.ticks.length-1]-q.ticks[0]);q.tickWidth=q.length/(q.ticks.length-1)}}v=n(v,{originX:q.beginX,originY:q.beginY});if(q.axisType=="x"){v.axis.x=n(v.axis.x,q);w.add(new Kinetic.Line({points:[q.beginX,q.beginY,q.endX,q.beginY],stroke:"red",strokeWidth:1,lineCap:"round",lineJoin:"round"}));for(t=0,r=q.ticks.length;t<r;t++){y=new Kinetic.SimpleText({x:q.beginX+(t+0.5)*q.tickWidth,y:q.beginY+5,text:q.ticks[t]+"",textFill:"#000000",textAlign:"center"});w.add(y)}}else{if(q.axisType=="y"){v.axis.y=n(v.axis.y,q);w.add(new Kinetic.Line({points:[q.beginX,q.beginY,q.beginX,q.endY],stroke:"red",strokeWidth:1,lineCap:"round",lineJoin:"round"}));for(t=0,r=q.ticks.length;t<r;t++){y=new Kinetic.SimpleText({x:q.beginX-10,y:q.beginY-t*q.tickWidth,text:q.ticks[t]+"",textFill:"#000000",textBaseline:"middle",textAlign:"right"});w.add(y)}}}};h.prototype={constructor:h,getX:function(p){var q=this.options;return q.beginX+(p+0.5)*q.tickWidth},getY:function(q){var p=this.options;return q*p.scaleSize},getOrigin:function(){return{x:this.beginX,y:this.beginY}}};var a=function(q,z,J){var G={legendWrap:{fillColor:"#EFEFEF",strokeColor:"#CCCCCC",strokeWidth:"1"},itemType:"rect",position:["right","top"],width:"80",height:"100"};q.legend=n(G,q.legend);var y=["skyblue","orangered","yellow","orange","violet","fuchsia","yellowgreen","khaki"];var u=q.legend,C=u.width,s=u.height,x=u.position,v,B={"left-top":{x:0,y:0},"right-top":{x:q.width-C,y:0},"right-bottom":{x:q.width-C,y:q.height-s}},I={rect:"Rect",circle:"Circle"};if(m.isNumber(x[0])){v={x:x[0],y:x[1]}}else{x=x.join("-");for(v in B){if(x==v){v=B[v];break}}}var D;for(var r in I){if(u.itemType==r){D=I[r];break}}var E=z.series.length,t=[],p=Math.ceil(s/E);z.series=z.series.sort(function(L,K){return K.data-L.data});for(var A=0;A<E;A++){t.push(z.series[A].name)}for(var F=0;F<E;F++){var H;if(D=="Circle"){H=new Kinetic[D]({x:v.x+5,y:v.y+F*p+12,radius:8,fill:y[F]})}else{if(D=="Rect"){H=new Kinetic[D]({x:v.x+5,y:v.y+F*p+5,width:10,height:10,fill:y[F]})}}var w=new Kinetic.Text({x:v.x+12+5+5,y:v.y+(F-1)*p+p+5,text:t[F]+"",fontSize:10,fontFamily:"Curier",textFill:"#000"});J.add(H);J.add(w)}};var e=function(F,B){var D={color:"#CCCCCC",columns:[],strokeWidth:1,opacity:0.4,lineCap:"round"};F.grid=n(D,F.grid);var v=this.beginX=F.originX,t=this.beginY=F.originY,p=F.axis.x,A=F.axis.y,z=F.grid.enableXGrid,y=F.grid.enableYGrid;var C=A.tickWidth,E=A.ticks.length,s=p.tickWidth,w=p.ticks.length;if(z){for(var r=1;r<E;r++){var q=new Kinetic.Line({points:[v,t-C*r,s*(w+1),t-C*r],stroke:F.grid.color,strokeWidth:F.grid.strokeWidth,lineCap:F.grid.lineCap,alpha:F.grid.opacity});B.add(q)}}if(y){for(var x=1;x<=w;x++){var u=new Kinetic.Line({points:[v+s*x,t,v+s*x,t-C*(E-1)],stroke:F.grid.color,strokeWidth:F.grid.strokeWidth,lineCap:F.grid.lineCap,alpha:F.grid.opacity});B.add(u)}}};var k=null;function i(A,z,r,v){if(k==null){k=new Kinetic.Layer()}else{k.clear()}(v==c)&&(v="top");(v=="top")&&(z=z-10);(v=="left")&&(A=A-10);(v=="right")&&(A=A+10);(v=="bottom")&&(z=z+10);var C=function(D,x,H){var G=["M",A,z],y=5,F,E;x+=(2*H||0);D+=(2*H||0);switch(v){case"right":x=Math.max(y*2,x);G.push("l",y,-y);G.push("v",-(x/2-y));G.push("h",D);G.push("v",x,"h",-D);G.push("v",-(x/2-y));G.push("l",-y,-y);F=A+y;E=z-x/2;break;case"top":D=Math.max(y*2,D);G.push("l",-y,-y);G.push("h",-(D/2-y));G.push("v",-x,"h",D,"v",x);G.push("h",-(D/2-y));G.push("l",-y,y);F=A-D/2;E=z-y-x;break;case"left":x=Math.max(y*2,x);G.push("l",-y,y);G.push("v",x/2-y);G.push("h",-D,"v",-x,"h",D);G.push("v",x/2-y);G.push("l",y,y);F=A-y-D;E=z-x/2;break;case"bottom":D=Math.max(y*2,D);G.push("l",y,y);G.push("h",D/2-y);G.push("v",x,"h",-D,"v",-x);G.push("h",D/2-y);G.push("l",y,-y);F=A-D/2;E=z+y;break}G.push("z");return{path:G,box:{left:F,top:E,width:D,height:x}}};var s=new Kinetic.Text({x:A,y:-200,fontSize:12,text:""+r}),p=s.getTextWidth(),u=s.getTextHeight();var w=C(p,u,10),q=w.path,t=w.box;q=q.join(",");if(r){var B=new Kinetic.Text({x:t.left+10,y:t.top+10,text:""+r,align:"center",fontSize:12,textFill:"#FF7018"})}var C=new Kinetic.Path({data:q,stroke:"#EFEFEF",scale:1,fill:"#FFFFFF",draggable:true,shadow:{color:"#000",blur:5,alpha:0.4,offset:[2,2]}});k.removeChildren();k.add(C);k.add(B);return k}function l(p){p.clear()}m.tooltips=i;m.toolTipHide=l;d.CanvasChart=m})(this);